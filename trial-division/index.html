<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>1&nbsp; Trial Division – The Interactive Guide to Integer Factorization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references/index.html" rel="next">
<link href="../index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d9ea66fcd6c317012447f26e9c021348.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../trial-division/index.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Trial Division</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../" class="sidebar-logo-link">
      <img src="../cover.png" alt="The Interactive Guide to Integer Factorization cover" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../cover.png" alt="The Interactive Guide to Integer Factorization cover" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">The Interactive Guide to Integer Factorization</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trial-division/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Trial Division</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#test-everything" id="toc-test-everything" class="nav-link active" data-scroll-target="#test-everything"><span class="header-section-number">1.1</span> Test everything!</a></li>
  <li><a href="#getting-all-the-factors" id="toc-getting-all-the-factors" class="nav-link" data-scroll-target="#getting-all-the-factors"><span class="header-section-number">1.2</span> Getting all the factors</a></li>
  <li><a href="#square-root-stopping-condition" id="toc-square-root-stopping-condition" class="nav-link" data-scroll-target="#square-root-stopping-condition"><span class="header-section-number">1.3</span> Square root stopping condition</a></li>
  <li><a href="#wheel-trial-division" id="toc-wheel-trial-division" class="nav-link" data-scroll-target="#wheel-trial-division"><span class="header-section-number">1.4</span> Wheel trial division</a></li>
  <li><a href="#pre-computing-primes-with-the-sieve-of-eratosthenes" id="toc-pre-computing-primes-with-the-sieve-of-eratosthenes" class="nav-link" data-scroll-target="#pre-computing-primes-with-the-sieve-of-eratosthenes"><span class="header-section-number">1.5</span> Pre-computing primes with the Sieve of Eratosthenes</a></li>
  <li><a href="#sec-isqrtn" id="toc-sec-isqrtn" class="nav-link" data-scroll-target="#sec-isqrtn"><span class="header-section-number">1.6</span> Rolling our own isqrt(n)</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Trial Division</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="test-everything" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="test-everything"><span class="header-section-number">1.1</span> Test everything!</h2>
<p>The simplest possible algorithm for factoring an integer <em>n</em> is to just try every possible factor <em>f</em> and look for one that evenly divides <em>n</em>. In other words, the remainder of <em>n</em> when dividing by <em>f</em> (written <code>n % f</code>) should be zero. We start at 2 because every integer is divisible by 1, and we’re looking for a nontrivial factor.</p>
<div>
<div id="pyodide-1" class="exercise-cell">

</div>
<script type="pyodide-1-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHRyaWFsX2RpdmlzaW9uX2JydXRlX2ZvcmNlKG4pOlxuICAgIGYgPSAyXG4gICAgd2hpbGUgVHJ1ZTpcbiAgICAgICAgaWYgbiAlIGYgPT0gMDpcbiAgICAgICAgICAgIHJldHVybiBmXG4gICAgICAgIGYgKz0gMVxuXG50cmlhbF9kaXZpc2lvbl9icnV0ZV9mb3JjZSg2MykgICMgUmV0dXJucyAzIn0=
</script>
</div>
<p>This function will always return eventually, once <em>f</em> = <em>n</em>, because every integer is divisible by itself. If no smaller factor was found, <em>n</em> is prime.</p>
<div>
<div id="pyodide-2" class="exercise-cell">

</div>
<script type="pyodide-2-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoidHJpYWxfZGl2aXNpb25fYnJ1dGVfZm9yY2UoMTcpICAjIFJldHVybnMgMTcifQ==
</script>
</div>
<p>This algorithm always returns the smallest factor. This factor will always be prime, since if it was a composite number, we already would’ve encountered its factors earlier in the loop.</p>
</section>
<section id="getting-all-the-factors" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="getting-all-the-factors"><span class="header-section-number">1.2</span> Getting all the factors</h2>
<p>The above method only returns one prime factor, but if we want all of them, we can just divide <em>n</em> by the first factor, then factor what’s left, until reaching 1:</p>
<div>
<div id="pyodide-3" class="exercise-cell">

</div>
<script type="pyodide-3-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHRyaWFsX2RpdmlzaW9uX2JydXRlX2ZvcmNlX2FsbF9mYWN0b3JzKG4pOlxuICAgIGZhY3RvcnMgPSBbXVxuICAgIHdoaWxlIG4gIT0gMTpcbiAgICAgICAgZiA9IHRyaWFsX2RpdmlzaW9uX2JydXRlX2ZvcmNlKG4pXG4gICAgICAgIGZhY3RvcnMuYXBwZW5kKGYpXG4gICAgICAgIG4gLy89IGYgICAjIC8vIG9wZXJhdG9yIGlzIGludGVnZXIgZGl2aXNpb25cbiAgICByZXR1cm4gZmFjdG9yc1xuXG5mYWN0b3JzID0gdHJpYWxfZGl2aXNpb25fYnJ1dGVfZm9yY2VfYWxsX2ZhY3RvcnMoNjMpICAjIFJldHVybnMgWzMsIDMsIDddXG5mYWN0b3JzIn0=
</script>
</div>
<p>This will work with any factoring method that returns a prime factor. However, in this case this method is wasteful, because it repeatedly checks small factors that were already checked on previous calls. Better is to capture all the factors as we go:</p>
<div>
<div id="pyodide-4" class="exercise-cell">

</div>
<script type="pyodide-4-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHRyaWFsX2RpdmlzaW9uX2JydXRlX2ZvcmNlX2FsbF9mYWN0b3JzX2NvbWJpbmVkKG4pOlxuICAgIGZhY3RvcnMgPSBbXVxuICAgIGYgPSAyXG4gICAgd2hpbGUgbiAhPSAxOlxuICAgICAgICBpZiBuICUgZiA9PSAwOlxuICAgICAgICAgICAgZmFjdG9ycy5hcHBlbmQoZilcbiAgICAgICAgICAgIG4gLy89IGZcbiAgICAgICAgZWxzZTpcbiAgICAgICAgICAgIGYgKz0gMVxuICAgIHJldHVybiBmYWN0b3JzXG5cbnRyaWFsX2RpdmlzaW9uX2JydXRlX2ZvcmNlX2FsbF9mYWN0b3JzX2NvbWJpbmVkKDYzKSJ9
</script>
</div>
<p>Note that because factors can be repeated (like 3 here) we must only increment <em>f</em> in the <code>else</code> branch.</p>
<p>Once you have all the factors, verifying them by multiplication is easy (note this also works if <code>factors</code> is <code>[]</code>):</p>
<div>
<div id="pyodide-5" class="exercise-cell">

</div>
<script type="pyodide-5-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoicHJvZHVjdCA9IDFcbmZvciBmIGluIGZhY3RvcnM6XG4gICAgcHJvZHVjdCAqPSBmXG5wcm9kdWN0ICAjIFJldHVybnMgNjMifQ==
</script>
</div>
</section>
<section id="square-root-stopping-condition" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="square-root-stopping-condition"><span class="header-section-number">1.3</span> Square root stopping condition</h2>
<p>The worst case for <code>trial_division_brute_force()</code> is on a large prime, such as 4256233. In this case, it tries every number less than <em>n</em> before concluding that <em>n</em> is the only factor (O(<em>n</em>) complexity). To fix this problem, we take advantage of this observation:</p>
<p><strong>Factors always come in pairs.</strong> If <em>n</em> is divisible by <em>a</em>, then it is also divisible by <em>n/a</em>, and one of these will always be <span class="math inline">\(\le \sqrt{n}\)</span>. This is because if both of them were <span class="math inline">\(&gt; \sqrt{n}\)</span>, their product would be &gt; <span class="math inline">\(n\)</span> (and it’s not, it’s exactly <span class="math inline">\(n\)</span>).</p>
<p>Exploiting this gives us a faster trial division algorithm, the most well-known version, with <span class="math inline">\(O(\sqrt{n})\)</span> complexity:</p>
<div>
<div id="pyodide-6" class="exercise-cell">

</div>
<script type="pyodide-6-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdFxuXG5kZWYgdHJpYWxfZGl2aXNpb24obik6XG4gICAgZiA9IDJcbiAgICB3aGlsZSBmICogZiA8PSBuOiAgIyBUZXN0IGlmIGYgPD0gc3FydChuKSB1c2luZyBtdWx0aXBsaWNhdGlvblxuICAgICAgICBpZiBuICUgZiA9PSAwOlxuICAgICAgICAgICAgcmV0dXJuIGZcbiAgICAgICAgZiArPSAxXG4gICAgcmV0dXJuIG4gICMgSWYgbm8gZmFjdG9yIDwgc3FydChuKSBmb3VuZCwgbiBpcyB0aGUgc21hbGxlc3RcblxuIyBUaGVzZSBib3RoIHJldHVybiA0MjU2MjMzIGJ1dCB0cmlhbF9kaXZpc2lvbiBpcyBtdWNoIGZhc3RlclxucHJpbnQodGltZWl0LnRpbWVpdChsYW1iZGE6IHRyaWFsX2RpdmlzaW9uX2JydXRlX2ZvcmNlKDQyNTYyMzMpLCBudW1iZXI9MSkpXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogdHJpYWxfZGl2aXNpb24oNDI1NjIzMyksIG51bWJlcj0xMCkpIn0=
</script>
</div>
<p>In contexts where <code>f * f</code> can overflow, <code>f &lt;= n/f</code> avoids this, but is more expensive. Both <code>f * f</code> and <code>f &lt;= n/f</code> can be avoided by pre-computing <code>sqrt_n</code> using Python’s efficient <code>math.isqrt(n)</code>:</p>
<div>
<div id="pyodide-7" class="exercise-cell">

</div>
<script type="pyodide-7-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aFxuXG5kZWYgdHJpYWxfZGl2aXNpb25faXNxcnQobik6XG4gICAgZiA9IDJcbiAgICBzcXJ0X24gPSBtYXRoLmlzcXJ0KG4pXG4gICAgd2hpbGUgZiA8PSBzcXJ0X246XG4gICAgICAgIGlmIG4gJSBmID09IDA6XG4gICAgICAgICAgICByZXR1cm4gZlxuICAgICAgICBmICs9IDFcbiAgICByZXR1cm4gblxuXG4jIGlzcXJ0IHZlcnNpb24gaXMgbW9kZXN0bHkgZmFzdGVyIGZvciBsYXJnZSBwcmltZXNcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbigzODg1OTI0OTI4OTMxKSwgbnVtYmVyPTEpKVxucHJpbnQodGltZWl0LnRpbWVpdChsYW1iZGE6IHRyaWFsX2RpdmlzaW9uX2lzcXJ0KDM4ODU5MjQ5Mjg5MzEpLCBudW1iZXI9MSkpIn0=
</script>
</div>
<p>We’ll describe how to efficiently implement <code>isqrt(n)</code> yourself later in <a href="#sec-isqrtn" class="quarto-xref"><span>Section 1.6</span></a>.</p>
</section>
<section id="wheel-trial-division" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="wheel-trial-division"><span class="header-section-number">1.4</span> Wheel trial division</h2>
<p>There is no point in testing even factors &gt; 2, since if 2 doesn’t divide into <em>n</em>, no larger even number will. This reduces runtime by about 2x.</p>
<div>
<div id="pyodide-8" class="exercise-cell">

</div>
<script type="pyodide-8-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aFxuXG5kZWYgdHJpYWxfZGl2aXNpb25fc2tpcF9ldmVuKG4pOlxuICAgIGlmIG4gJSAyID09IDA6XG4gICAgICAgIHJldHVybiAyXG4gICAgZiA9IDNcbiAgICBzcXJ0X24gPSBtYXRoLmlzcXJ0KG4pXG4gICAgd2hpbGUgZiA8PSBzcXJ0X246XG4gICAgICAgIGlmIG4gJSBmID09IDA6XG4gICAgICAgICAgICByZXR1cm4gZlxuICAgICAgICBmICs9IDJcbiAgICByZXR1cm4gblxuXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogdHJpYWxfZGl2aXNpb25faXNxcnQoMzg4NTkyNDkyODkzMSksIG51bWJlcj0xKSlcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl9za2lwX2V2ZW4oMzg4NTkyNDkyODkzMSksIG51bWJlcj0xKSkifQ==
</script>
</div>
<p>This technique can be generalized: suppose we want to skip both all even numbers and all multiples of 3 (other than 2 and 3 themselves). To do this, we break up the factors into groups of 6 starting at 5, the next prime value:</p>
<p>1 2 3 4 [5 6 7 8 9 10] [11 12 13 14 15 16] [17 18 19 20 21 22] …</p>
<p>The numbers in each group can be written as 6k−1, 6k, 6k+1, 6k+2, 6k+3, 6k+4. Three of these (6k, 6k+2, 6k+4) will always be even and can be ignored. Two of them (6k, 6k+3) will always be multiples of 3. That leaves only 6k−1 and 6k+1 that need to be checked:</p>
<p>1 2 3 4 [5 _ 7 _ _ _ ] [11 __ 13 __ __ __ ] [17 __ 19 __ __ __ ] …</p>
<p>To implement this, we start at 5 and alternate between incrementing by 2 and incrementing by 4:</p>
<div>
<div id="pyodide-9" class="exercise-cell">

</div>
<script type="pyodide-9-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aFxuXG5kZWYgdHJpYWxfZGl2aXNpb25fd2hlZWxfNihuKTpcbiAgICBpZiBuICUgMiA9PSAwOiByZXR1cm4gMlxuICAgIGlmIG4gJSAzID09IDA6IHJldHVybiAzXG5cbiAgICBzcXJ0X24gPSBtYXRoLmlzcXJ0KG4pXG4gICAgZiA9IDVcbiAgICB3aGlsZSBmIDw9IHNxcnRfbjpcbiAgICAgICAgaWYgbiAlIGYgPT0gMDogcmV0dXJuIGYgICMgQ2hlY2sgNmstMVxuICAgICAgICBmICs9IDJcbiAgICAgICAgaWYgbiAlIGYgPT0gMDogcmV0dXJuIGYgICMgQ2hlY2sgNmsrMVxuICAgICAgICBmICs9IDRcbiAgICByZXR1cm4gblxuXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogdHJpYWxfZGl2aXNpb25fc2tpcF9ldmVuKDM4ODU5MjQ5Mjg5MzEpLCBudW1iZXI9MSkpXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogdHJpYWxfZGl2aXNpb25fd2hlZWxfNigzODg1OTI0OTI4OTMxKSwgbnVtYmVyPTEpKSAgICAifQ==
</script>
</div>
<p>The same idea generalizes to even more primes: we could remove all multiples of 2, 3, and 5 using a wheel of size 2 × 3 × 5 = 30, or all multiplies of 2, 3, 5, and 7 using a wheel of size 210. As we increase the wheel size, the number of divisions drops, but the number of residues (and number of <code>if</code> statements) also increases rapidly:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Wheel size</th>
<th style="text-align: left;">Basis primes</th>
<th style="text-align: left;">if statements per loop</th>
<th style="text-align: left;">Factors checked (%)</th>
<th style="text-align: left;">Theoretical speedup</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>1</strong></td>
<td style="text-align: left;">None</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">100.00%</td>
<td style="text-align: left;">1.00x</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>2</strong></td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">50.00%</td>
<td style="text-align: left;">2.00x</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>6</strong></td>
<td style="text-align: left;">2, 3</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">33.33%</td>
<td style="text-align: left;">3.00x</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>30</strong></td>
<td style="text-align: left;">2, 3, 5</td>
<td style="text-align: left;">8</td>
<td style="text-align: left;">26.67%</td>
<td style="text-align: left;">3.75x</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>210</strong></td>
<td style="text-align: left;">2, 3, 5, 7</td>
<td style="text-align: left;">48</td>
<td style="text-align: left;">22.86%</td>
<td style="text-align: left;">4.37x</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>2,310</strong></td>
<td style="text-align: left;">… 11</td>
<td style="text-align: left;">480</td>
<td style="text-align: left;">20.78%</td>
<td style="text-align: left;">4.81x</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>30,030</strong></td>
<td style="text-align: left;">… 13</td>
<td style="text-align: left;">5,760</td>
<td style="text-align: left;">19.18%</td>
<td style="text-align: left;">5.21x</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>510,510</strong></td>
<td style="text-align: left;">… 17</td>
<td style="text-align: left;">92,160</td>
<td style="text-align: left;">18.05%</td>
<td style="text-align: left;">5.54x</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>9,699,690</strong></td>
<td style="text-align: left;">… 19</td>
<td style="text-align: left;">1,658,880</td>
<td style="text-align: left;">17.10%</td>
<td style="text-align: left;">5.85x</td>
</tr>
</tbody>
</table>
<p>Rather than write thousands of lines of code by hand, we can instead use Python metaprogramming techniques, in which you build up a string containing the code and then use <code>exec()</code> on it, to create a version of <code>trial_division_wheel()</code> for each possible wheel size:</p>
<div>
<div id="pyodide-10" class="exercise-cell">

</div>
<script type="pyodide-10-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aFxuXG5kZWYgZ2VuZXJhdGVfdHJpYWxfZGl2aXNpb25fd2hlZWwocHJpbWVzLCB3aGVlbF9zaXplKTpcbiAgICByZXNpZHVlcyA9IFtcbiAgICAgICAgaSBmb3IgaSBpbiByYW5nZSgxLCB3aGVlbF9zaXplICsgMSkgXG4gICAgICAgIGlmIGFsbChpICUgcCAhPSAwIGZvciBwIGluIHByaW1lcylcbiAgICBdXG5cbiAgICAjIENvbXB1dGUgZ2FwcyAoZGlzdGFuY2VzIGJldHdlZW4gdGhlIHJlc2lkdWVzKVxuICAgIGdhcHMgPSBbcmVzaWR1ZXNbaSsxXSAtIHJlc2lkdWVzW2ldIGZvciBpIGluIHJhbmdlKGxlbihyZXNpZHVlcykgLSAxKV1cbiAgICBnYXBzLmFwcGVuZCgod2hlZWxfc2l6ZSArIHJlc2lkdWVzWzBdKSAtIHJlc2lkdWVzWy0xXSlcbiAgICBcbiAgICBmdW5jX25hbWUgPSBmXCJ0cmlhbF9kaXZpc2lvbl93aGVlbF97d2hlZWxfc2l6ZX1cIlxuICAgIGNvZGVfbGluZXMgPSBbZlwiZGVmIHtmdW5jX25hbWV9KG4pOlwiXVxuICAgIGZvciBwIGluIHByaW1lczpcbiAgICAgICAgY29kZV9saW5lcy5hcHBlbmQoZlwiICAgIGlmIG4gJSB7cH0gPT0gMDogcmV0dXJuIHtwfVwiKVxuICAgIFxuICAgIGNvZGVfbGluZXMuYXBwZW5kKGZcIiAgICBzcXJ0X24gPSBtYXRoLmlzcXJ0KG4pXCIpXG4gICAgIyBTdGFydCB3aXRoIHJlc2lkdWVzWzFdIHdoaWNoIGlzIG5leHQgcHJpbWUgKHNraXAgMSlcbiAgICBjb2RlX2xpbmVzLmFwcGVuZChmXCIgICAgZiA9IHtyZXNpZHVlc1sxXX1cIikgIFxuICAgIGNvZGVfbGluZXMuYXBwZW5kKGZcIiAgICB3aGlsZSBmIDw9IHNxcnRfbjpcIilcbiAgICBcbiAgICAjIFJvdGF0ZSBnYXBzIGJlY2F1c2Ugd2Ugc3RhcnRlZCB3aXRoIHJlc2lkdWVzWzFdXG4gICAgcm90YXRlZF9nYXBzID0gZ2Fwc1sxOl0gKyBbZ2Fwc1swXV0gIyBcbiAgICBmb3IgZ2FwIGluIChyb3RhdGVkX2dhcHMpOiAgXG4gICAgICAgIGNvZGVfbGluZXMuYXBwZW5kKGZcIiAgICAgICAgaWYgbiAlIGYgPT0gMDogcmV0dXJuIGZcIilcbiAgICAgICAgY29kZV9saW5lcy5hcHBlbmQoZlwiICAgICAgICBmICs9IHtnYXB9XCIpXG4gICAgY29kZV9saW5lcy5hcHBlbmQoZlwiICAgIHJldHVybiBuXCIpXG4gICAgXG4gICAgbmFtZXNwYWNlID0ge1wibWF0aFwiOiBtYXRofVxuICAgIGV4ZWMoXCJcXG5cIi5qb2luKGNvZGVfbGluZXMpLCBuYW1lc3BhY2UpXG4gICAgcmV0dXJuIG5hbWVzcGFjZVtmdW5jX25hbWVdXG5cbnRyaWFsX2RpdmlzaW9uX3doZWVsXzYgPSBnZW5lcmF0ZV90cmlhbF9kaXZpc2lvbl93aGVlbChbMiwzXSwgNilcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl93aGVlbF82KDM4ODU5MjQ5Mjg5MzEpLCBudW1iZXI9MTApKVxudHJpYWxfZGl2aXNpb25fd2hlZWxfMzAgPSBnZW5lcmF0ZV90cmlhbF9kaXZpc2lvbl93aGVlbChbMiwzLDVdLCAzMClcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl93aGVlbF8zMCgzODg1OTI0OTI4OTMxKSwgbnVtYmVyPTEwKSlcbnRyaWFsX2RpdmlzaW9uX3doZWVsXzIxMCA9IGdlbmVyYXRlX3RyaWFsX2RpdmlzaW9uX3doZWVsKFsyLDMsNSw3XSwgMjEwKVxucHJpbnQodGltZWl0LnRpbWVpdChsYW1iZGE6IHRyaWFsX2RpdmlzaW9uX3doZWVsXzIxMCgzODg1OTI0OTI4OTMxKSwgbnVtYmVyPTEwKSlcbnRyaWFsX2RpdmlzaW9uX3doZWVsXzIzMTAgPSBnZW5lcmF0ZV90cmlhbF9kaXZpc2lvbl93aGVlbChbMiwzLDUsNywxMV0sIDIzMTApXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogdHJpYWxfZGl2aXNpb25fd2hlZWxfMjMxMCgzODg1OTI0OTI4OTMxKSwgbnVtYmVyPTEwKSlcbnRyaWFsX2RpdmlzaW9uX3doZWVsXzMwMDMwID0gZ2VuZXJhdGVfdHJpYWxfZGl2aXNpb25fd2hlZWwoWzIsMyw1LDcsMTEsMTNdLCAzMDAzMClcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl93aGVlbF8zMDAzMCgzODg1OTI0OTI4OTMxKSwgbnVtYmVyPTEwKSkifQ==
</script>
</div>
<p>Results show improving performance but with diminishing returns as wheel size increases. If we increase wheel size too much, the code no longer fits in icache and performance degrades drastically. Practical implementations usually pick a fixed wheel size such as 2310, small enough to make this unlikely.</p>
</section>
<section id="pre-computing-primes-with-the-sieve-of-eratosthenes" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="pre-computing-primes-with-the-sieve-of-eratosthenes"><span class="header-section-number">1.5</span> Pre-computing primes with the Sieve of Eratosthenes</h2>
<p>Suppose rather than just factoring one number, we wanted to factor <em>many</em> numbers. In this case, rather than using a wheel, it’s more efficient to precompute all possible prime factors for all the numbers (up to sqrt of the largest <em>n</em>), and then reuse that list for factoring each one.</p>
<p>To precompute the list of primes, we could use trial division to test if each factor is prime, but this is too slow. A faster way is the classical <strong>Sieve of Eratosthenes</strong>. It begins by assuming all numbers are prime, then removes all multiples of 2, then all multiples of 3, and so on:</p>
<div>
<div id="pyodide-11" class="exercise-cell">

</div>
<script type="pyodide-11-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aFxuXG5kZWYgZ2V0X3ByaW1lc191cF90byhuKTpcbiAgICByZXN1bHQgPSBbXVxuICAgIHNpZXZlID0gW1RydWVdICogKG4rMSlcbiAgICBzaWV2ZVswXSwgc2lldmVbMV0gPSBGYWxzZSwgRmFsc2VcbiAgICBmb3IgaSBpbiByYW5nZSgyLCBuKzEpOlxuICAgICAgICBpZiBzaWV2ZVtpXTpcbiAgICAgICAgICAgIHJlc3VsdC5hcHBlbmQoaSlcbiAgICAgICAgICAgIGZvciBqIGluIHJhbmdlKGkqaSwgbisxLCBpKTpcbiAgICAgICAgICAgICAgICBzaWV2ZVtqXSA9IEZhbHNlXG4gICAgcmV0dXJuIHJlc3VsdFxuXG5nZXRfcHJpbWVzX3VwX3RvKDUwKSJ9
</script>
</div>
<p>The <code>range(i*i, n+1, i)</code> skips in steps of <code>i</code>. We start at <code>i*i</code> because <code>j*i</code> for all <code>j &lt; i</code> were already covered by earlier smaller factors. The complexity <span class="math inline">\(O(n \log \log n)\)</span> comes from the fact that <span class="math inline">\(n/2 + n/3 + n/5 + ...\)</span> (<em>n</em> times the sum of the reciprocals of the primes) is proportional to <span class="math inline">\(n \log \log n\)</span>.</p>
<p>Now we use this list to speed up factoring:</p>
<div>
<div id="pyodide-12" class="exercise-cell">

</div>
<script type="pyodide-12-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aCwgcmFuZG9tXG5cbiMgRmluZCBvbmUgcHJpbWUgZmFjdG9yIGZvciBlYWNoIG4gaW4gbl9saXN0XG5kZWYgdHJpYWxfZGl2aXNpb25fbWFueShuX2xpc3QpOlxuICAgIHByaW1lcyA9IGdldF9wcmltZXNfdXBfdG8obWF0aC5pc3FydChtYXgobl9saXN0KSkpXG4gICAgcmVzdWx0cyA9IFtdXG4gICAgZm9yIG4gaW4gbl9saXN0OlxuICAgICAgICBmID0gblxuICAgICAgICBmb3IgcCBpbiBwcmltZXM6XG4gICAgICAgICAgICBpZiBuICUgcCA9PSAwOlxuICAgICAgICAgICAgICAgIGYgPSBwXG4gICAgICAgICAgICAgICAgYnJlYWtcbiAgICAgICAgcmVzdWx0cy5hcHBlbmQoZilcbiAgICByZXR1cm4gcmVzdWx0c1xuXG5wcmludChcIkxpc3Qgc2l6ZSAxOlwiKVxubl9saXN0ID0gWzM4ODU5MjQ5Mjg5MzFdXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogW3RyaWFsX2RpdmlzaW9uX3doZWVsXzMwMDMwKG4pIGZvciBuIGluIG5fbGlzdF0sIG51bWJlcj0xKSlcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl9tYW55KG5fbGlzdCksIG51bWJlcj0xKSlcblxucHJpbnQoXCJMaXN0IHNpemUgMTAwMDpcIilcbm5fbGlzdCA9IFtyYW5kb20ucmFuZGludCgxLCA5OTlfMDAwXzAwMCkgZm9yIF8gaW4gcmFuZ2UoMTAwMCldXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogW3RyaWFsX2RpdmlzaW9uX3doZWVsXzMwMDMwKG4pIGZvciBuIGluIG5fbGlzdF0sIG51bWJlcj0xKSlcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl9tYW55KG5fbGlzdCksIG51bWJlcj0xKSkifQ==
</script>
</div>
<p>On short lists wheel trial division is faster, but on long lists <code>trial_division_many()</code> quickly takes the lead. Many practical implementations will include hard-coded lists of primes to handle factoring numbers up to a certain size (e.g.&nbsp;all 32-bit integers can be factored with a list of just 6542 primes, small enough to fit in a typical L2 cache).</p>
<p>One downside of <code>trial_division_many()</code> is that it requires <span class="math inline">\(O(\sqrt{n})\)</span> space to hold the sieve array in <code>get_primes_up_to()</code>, whereas <code>trial_division_wheel</code> uses constant space. This can be addressed with a <strong>segmented</strong> sieve, where the sieving range is broken up into pieces of size <span class="math inline">\(\sqrt{\sqrt{n}} = n^{1/4}\)</span>, and we only keep one piece in memory at a time. Segmenting sieving will be a valuable part of algorithms discussed later in this book.</p>
<p>To see how this works, suppose we were naively running trial division on every number in the segment:</p>
<div>
<div id="pyodide-13" class="exercise-cell">

</div>
<script type="pyodide-13-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIGdldF9wcmltZXNfYmV0d2Vlbl9kdW1iKG1pbl9wLCBtYXhfcCk6XG4gICAgcHJpbWVzID0gW11cbiAgICBmb3IgaSBpbiByYW5nZShtaW5fcCwgbWF4X3AgKyAxKTpcbiAgICAgICAgaWYgdHJpYWxfZGl2aXNpb25faXNxcnQoaSkgPT0gaTpcbiAgICAgICAgICAgIHByaW1lcy5hcHBlbmQoaSlcbiAgICByZXR1cm4gcHJpbWVzIn0=
</script>
</div>
<p>Notice that <code>trial_division_isqrt()</code> only ever checks for factors up to <code>sqrt(max_p)</code>. Therefore, every value in the range is either a multiple of a number <code>&lt;= sqrt(max_p)</code>, or is prime. So all we have to do is precompute a list of primes at least up to that value, and pass it in:</p>
<div>
<div id="pyodide-14" class="exercise-cell">

</div>
<script type="pyodide-14-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBzaWV2ZV9wcmltZXMgaXMgYWxsIHByaW1lcyB1cCB0byBzcXJ0KG1heF9wKSAob3IgbW9yZSlcbmRlZiBnZXRfcHJpbWVzX2JldHdlZW4obWluX3AsIG1heF9wLCBzaWV2ZV9wcmltZXMpOlxuICAgIGlmIG1pbl9wIDwgMjogbWluX3AgPSAyXG4gICAgc2lldmUgPSBbVHJ1ZV0gKiAoKG1heF9wIC0gbWluX3ApICsgMSlcbiAgICBmb3IgcCBpbiBzaWV2ZV9wcmltZXM6XG4gICAgICAgICMgal9zdGFydCBpcyAgYW5kID49IHAqcFxuICAgICAgICBqX3N0YXJ0ID0gcCpwXG4gICAgICAgIGlmIGpfc3RhcnQgPCBtaW5fcDpcbiAgICAgICAgICAgICMgc2V0IHRvIGZpcnN0IG11bHRpcGxlIG9mIHAgPj0gbWluX3BcbiAgICAgICAgICAgIGpfc3RhcnQgPSAobWluX3AgKyBwIC0gMSkvL3AqcFxuICAgICAgICBmb3IgaiBpbiByYW5nZShqX3N0YXJ0LCBtYXhfcCsxLCBwKTpcbiAgICAgICAgICAgIHNpZXZlW2ogLSBtaW5fcF0gPSBGYWxzZVxuXG4gICAgcmVzdWx0ID0gW11cbiAgICBmb3IgaSBpbiByYW5nZSgwLCBsZW4oc2lldmUpKTpcbiAgICAgICAgaWYgc2lldmVbaV06XG4gICAgICAgICAgICByZXN1bHQuYXBwZW5kKGkgKyBtaW5fcClcbiAgICByZXR1cm4gcmVzdWx0XG5cbnNpZXZlX3ByaW1lcyA9IGdldF9wcmltZXNfdXBfdG8obWF0aC5pc3FydCgxMDIwMCkpXG5wcmludChmXCJzaWV2ZV9wcmltZXM6IHtzaWV2ZV9wcmltZXN9XCIpXG5wcmludChnZXRfcHJpbWVzX2JldHdlZW4oMTAwMDAsIDEwMTAwLCBzaWV2ZV9wcmltZXMpKVxucHJpbnQoZ2V0X3ByaW1lc19iZXR3ZWVuKDEwMTAwLCAxMDIwMCwgc2lldmVfcHJpbWVzKSkifQ==
</script>
</div>
<p>In the example call, only 25 primes are in <code>sieve_primes</code>, so each <code>get_primes_between()</code> will be fast.</p>
<p>Finally here is our updated <code>trial_division_many()</code>:</p>
<div>
<div id="pyodide-15" class="exercise-cell">

</div>
<script type="pyodide-15-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdCwgbWF0aCwgcmFuZG9tXG5cbiMgRmluZCBvbmUgcHJpbWUgZmFjdG9yIGZvciBlYWNoIG4gaW4gbl9saXN0XG5kZWYgdHJpYWxfZGl2aXNpb25fbWFueV9zZWdtZW50ZWRfc2lldmUobl9saXN0KTpcbiAgICB1bmZhY3RvcmVkX24gPSBzZXQobl9saXN0KVxuICAgIHJlc3VsdHMgPSB7fVxuXG4gICAgc2lldmVfbWF4ID0gbWF0aC5pc3FydChtYXgobl9saXN0KSlcbiAgICBzZWdtZW50X3NpemUgPSBtYXRoLmlzcXJ0KHNpZXZlX21heClcbiAgICBzaWV2ZV9wcmltZXMgPSBnZXRfcHJpbWVzX3VwX3RvKG1hdGguaXNxcnQoc2lldmVfbWF4KSlcblxuICAgICMgTG9vcCBvdmVyIHNpZXZlIHNlZ21lbnRzXG4gICAgZm9yIHBfbWluIGluIHJhbmdlKDAsIHNpZXZlX21heCwgc2VnbWVudF9zaXplKTpcbiAgICAgICAgcF9tYXggPSBwX21pbiArIHNlZ21lbnRfc2l6ZSAtIDFcbiAgICAgICAgcHJpbWVzX3NlZ21lbnQgPSBnZXRfcHJpbWVzX2JldHdlZW4ocF9taW4sIHBfbWF4LCBzaWV2ZV9wcmltZXMpXG4gICAgICAgIGZvciBuIGluIHNldCh1bmZhY3RvcmVkX24pOlxuICAgICAgICAgICAgZm9yIHAgaW4gcHJpbWVzX3NlZ21lbnQ6XG4gICAgICAgICAgICAgICAgaWYgbiAlIHAgPT0gMDpcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0c1tuXSA9IHBcbiAgICAgICAgICAgICAgICAgICAgdW5mYWN0b3JlZF9uLnJlbW92ZShuKVxuICAgICAgICAgICAgICAgICAgICBicmVha1xuXG4gICAgZm9yIG4gaW4gbl9saXN0OlxuICAgICAgICBpZiBuIG5vdCBpbiByZXN1bHRzOlxuICAgICAgICAgICAgcmVzdWx0c1tuXSA9IG5cblxuICAgIHJldHVybiByZXN1bHRzXG5cbm5fbGlzdCA9IFtyYW5kb20ucmFuZGludCgxLCA5Xzk5OV8wMDBfMDAwXzAwMCkgZm9yIF8gaW4gcmFuZ2UoMTAwKV1cbnByaW50KGZcIlRpbWU6IHt0aW1laXQudGltZWl0KGxhbWJkYTogdHJpYWxfZGl2aXNpb25fbWFueShuX2xpc3QpLCBudW1iZXI9MSl9XCIpXG5wcmludChmXCJTcGFjZToge21hdGguaXNxcnQobWF4KG5fbGlzdCkpfVwiKVxucHJpbnQoZlwiVGltZToge3RpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl9tYW55X3NlZ21lbnRlZF9zaWV2ZShuX2xpc3QpLCBudW1iZXI9MSl9XCIpXG5wcmludChmXCJTcGFjZToge21hdGguaXNxcnQobWF0aC5pc3FydChtYXgobl9saXN0KSkpfVwiKSJ9
</script>
</div>
<p>It iterates over the <span class="math inline">\(n^{1/4}\)</span> segments (each of size <span class="math inline">\(n^{1/4}\)</span>) and for each one, tests all primes in that segment against all remaining unfactored integers in the list. In exchange for a minor slowdown, space use is dramatically reduced, allowing the sieve to complete for large numbers that otherwise would not fit in available memory.</p>
</section>
<section id="sec-isqrtn" class="level2" data-number="1.6">
<h2 data-number="1.6" class="anchored" data-anchor-id="sec-isqrtn"><span class="header-section-number">1.6</span> Rolling our own isqrt(n)</h2>


<script type="pyodide-data">
eyJvcHRpb25zIjp7ImVudiI6eyJQTE9UTFlfUkVOREVSRVIiOiJwbG90bHlfbWltZXR5cGUifSwiaW5kZXhVUkwiOiJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvcHlvZGlkZS92MC4yOC4xL2Z1bGwvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsicHlvZGlkZV9odHRwIiwibWljcm9waXAiLCJpcHl0aG9uIl19fQ==
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJweW9kaWRlLTE1IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTUgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTE1LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTUtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xNSA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTUsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTE0IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTQgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTE0LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTQtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xNCA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEzIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTMgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTEzLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTMtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMyA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEyIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTIgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTEyLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTItY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMiA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTExIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTEgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTExLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTEtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMSA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTAgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTEwLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTAtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMCA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTAsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTkiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl85ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS05LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtOS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzkgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzksIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl84ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS04LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtOC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzggPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzgsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl83ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS03LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzcgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl82ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzYgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzYsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS01LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzUgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzUsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl80ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS00LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzQgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8zID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzMgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0yLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzIgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8xID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0xLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzEgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLXByZWx1ZGUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJweW9kaWRlT2pzID0ge1xuICBjb25zdCB7XG4gICAgUHlvZGlkZUV2YWx1YXRvcixcbiAgICBQeW9kaWRlRW52aXJvbm1lbnRNYW5hZ2VyLFxuICAgIHNldHVwUHl0aG9uLFxuICAgIHN0YXJ0UHlvZGlkZVdvcmtlcixcbiAgICBiNjREZWNvZGUsXG4gICAgY29sbGFwc2VQYXRoLFxuICB9ID0gd2luZG93Ll9leGVyY2lzZV9vanNfcnVudGltZTtcblxuICBjb25zdCBzdGF0dXNDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImV4ZXJjaXNlLWxvYWRpbmctc3RhdHVzXCIpO1xuICBjb25zdCBpbmRpY2F0b3JDb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImV4ZXJjaXNlLWxvYWRpbmctaW5kaWNhdG9yXCIpO1xuICBpbmRpY2F0b3JDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZShcImQtbm9uZVwiKTtcblxuICBsZXQgc3RhdHVzVGV4dCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIilcbiAgc3RhdHVzVGV4dC5jbGFzc0xpc3QgPSBcImV4ZXJjaXNlLWxvYWRpbmctZGV0YWlsc1wiO1xuICBzdGF0dXNUZXh0ID0gc3RhdHVzQ29udGFpbmVyLmFwcGVuZENoaWxkKHN0YXR1c1RleHQpO1xuICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYEluaXRpYWxpc2VgO1xuXG4gIC8vIEhvaXN0IGluZGljYXRvciBvdXQgZnJvbSBmaW5hbCBzbGlkZSB3aGVuIHJ1bm5pbmcgdW5kZXIgcmV2ZWFsXG4gIGNvbnN0IHJldmVhbFN0YXR1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2ZWFsIC5leGVyY2lzZS1sb2FkaW5nLWluZGljYXRvclwiKTtcbiAgaWYgKHJldmVhbFN0YXR1cykge1xuICAgIHJldmVhbFN0YXR1cy5yZW1vdmUoKTtcbiAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnJldmVhbCA+IC5zbGlkZXNcIikuYXBwZW5kQ2hpbGQocmV2ZWFsU3RhdHVzKTtcbiAgfVxuXG4gIC8vIE1ha2UgYW55IHJldmVhbCBzbGlkZXMgd2l0aCBsaXZlIGNlbGxzIHNjcm9sbGFibGVcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5yZXZlYWwgLmV4ZXJjaXNlLWNlbGxcIikuZm9yRWFjaCgoZWwpID0+IHtcbiAgICBlbC5jbG9zZXN0KCdzZWN0aW9uLnNsaWRlJykuY2xhc3NMaXN0LmFkZChcInNjcm9sbGFibGVcIik7XG4gIH0pXG5cbiAgLy8gUHlvZGlkZSBzdXBwbGVtZW50YWwgZGF0YSBhbmQgb3B0aW9uc1xuICBjb25zdCBkYXRhQ29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLWRhdGFcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShiNjREZWNvZGUoZGF0YUNvbnRlbnQpKTtcblxuICAvLyBHcmFiIGxpc3Qgb2YgcmVzb3VyY2VzIHRvIGJlIGRvd25sb2FkZWRcbiAgY29uc3QgZmlsZXNDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcInZmcy1maWxlXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgZmlsZXMgPSBKU09OLnBhcnNlKGI2NERlY29kZShmaWxlc0NvbnRlbnQpKTtcblxuICBsZXQgcHlvZGlkZVByb21pc2UgPSAoYXN5bmMgKCkgPT4ge1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgUHlvZGlkZWA7XG4gICAgY29uc3QgcHlvZGlkZSA9IGF3YWl0IHN0YXJ0UHlvZGlkZVdvcmtlcihkYXRhLm9wdGlvbnMpO1xuXG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBwYWNrYWdlOiBtaWNyb3BpcGA7XG4gICAgYXdhaXQgcHlvZGlkZS5sb2FkUGFja2FnZShcIm1pY3JvcGlwXCIpO1xuICAgIGNvbnN0IG1pY3JvcGlwID0gYXdhaXQgcHlvZGlkZS5weWltcG9ydChcIm1pY3JvcGlwXCIpO1xuICAgIGF3YWl0IGRhdGEucGFja2FnZXMucGtncy5tYXAoKHBrZykgPT4gKCkgPT4ge1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBwYWNrYWdlOiAke3BrZ31gO1xuICAgICAgcmV0dXJuIG1pY3JvcGlwLmluc3RhbGwocGtnKTtcbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcbiAgICBhd2FpdCBtaWNyb3BpcC5kZXN0cm95KCk7XG5cbiAgICAvLyBEb3dubG9hZCBhbmQgaW5zdGFsbCByZXNvdXJjZXNcbiAgICBhd2FpdCBmaWxlcy5tYXAoKGZpbGUpID0+IGFzeW5jICgpID0+IHtcbiAgICAgIGNvbnN0IG5hbWUgPSBmaWxlLnN1YnN0cmluZyhmaWxlLmxhc3RJbmRleE9mKCcvJykgKyAxKTtcbiAgICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgRG93bmxvYWRpbmcgcmVzb3VyY2U6ICR7bmFtZX1gO1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChmaWxlKTtcbiAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW4ndCBkb3dubG9hZCBcXGAke2ZpbGV9XFxgLiBFcnJvciAke3Jlc3BvbnNlLnN0YXR1c306IFwiJHtyZXNwb25zZS5zdGF0dXNUZXh0fVwiLmApO1xuICAgICAgfVxuICAgICAgY29uc3QgZGF0YSA9IGF3YWl0IHJlc3BvbnNlLmFycmF5QnVmZmVyKCk7XG5cbiAgICAgIC8vIFN0b3JlIFVSTHMgaW4gdGhlIGN3ZCB3aXRob3V0IGFueSBzdWJkaXJlY3Rvcnkgc3RydWN0dXJlXG4gICAgICBpZiAoZmlsZS5pbmNsdWRlcyhcIjovL1wiKSkge1xuICAgICAgICBmaWxlID0gbmFtZTtcbiAgICAgIH1cblxuICAgICAgLy8gQ29sbGFwc2UgaGlnaGVyIGRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGZpbGUgPSBjb2xsYXBzZVBhdGgoZmlsZSk7XG5cbiAgICAgIC8vIENyZWF0ZSBkaXJlY3RvcnkgdHJlZSwgaWdub3JpbmcgXCJkaXJlY3RvcnkgZXhpc3RzXCIgVkZTIGVycm9yc1xuICAgICAgY29uc3QgcGFydHMgPSBmaWxlLnNwbGl0KCcvJykuc2xpY2UoMCwgLTEpO1xuICAgICAgbGV0IHBhdGggPSAnJztcbiAgICAgIHdoaWxlIChwYXJ0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgIHBhdGggKz0gcGFydHMuc2hpZnQoKSArICcvJztcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBhd2FpdCBweW9kaWRlLkZTLm1rZGlyKHBhdGgpO1xuICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgaWYgKGUubmFtZSAhPT0gXCJFcnJub0Vycm9yXCIpIHRocm93IGU7XG4gICAgICAgICAgaWYgKGUuZXJybm8gIT09IDIwKSB7XG4gICAgICAgICAgICBjb25zdCBlcnJvclRleHRQdHIgPSBhd2FpdCBweW9kaWRlLl9tb2R1bGUuX3N0cmVycm9yKGUuZXJybm8pO1xuICAgICAgICAgICAgY29uc3QgZXJyb3JUZXh0ID0gYXdhaXQgcHlvZGlkZS5fbW9kdWxlLlVURjhUb1N0cmluZyhlcnJvclRleHRQdHIpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yICR7ZS5lcnJub30gXCIke2Vycm9yVGV4dH1cIi5gKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgLy8gV3JpdGUgdGhpcyBmaWxlIHRvIHRoZSBWRlNcbiAgICAgIHRyeSB7XG4gICAgICAgIHJldHVybiBhd2FpdCBweW9kaWRlLkZTLndyaXRlRmlsZShmaWxlLCBuZXcgVWludDhBcnJheShkYXRhKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChlLm5hbWUgIT09IFwiRXJybm9FcnJvclwiKSB0aHJvdyBlO1xuICAgICAgICBjb25zdCBlcnJvclRleHRQdHIgPSBhd2FpdCBweW9kaWRlLl9tb2R1bGUuX3N0cmVycm9yKGUuZXJybm8pO1xuICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBweW9kaWRlLl9tb2R1bGUuVVRGOFRvU3RyaW5nKGVycm9yVGV4dFB0cik7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgRmlsZXN5c3RlbSBFcnJvciAke2UuZXJybm99IFwiJHtlcnJvclRleHR9XCIuYCk7XG4gICAgICB9XG4gICAgfSkucmVkdWNlKChjdXIsIG5leHQpID0+IGN1ci50aGVuKG5leHQpLCBQcm9taXNlLnJlc29sdmUoKSk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYFB5b2RpZGUgZW52aXJvbm1lbnQgc2V0dXBgO1xuICAgIGF3YWl0IHNldHVwUHl0aG9uKHB5b2RpZGUpO1xuXG4gICAgc3RhdHVzVGV4dC5yZW1vdmUoKTtcbiAgICBpZiAoc3RhdHVzQ29udGFpbmVyLmNoaWxkcmVuLmxlbmd0aCA9PSAwKSB7XG4gICAgICBzdGF0dXNDb250YWluZXIucGFyZW50Tm9kZS5yZW1vdmUoKTtcbiAgICB9XG4gICAgcmV0dXJuIHB5b2RpZGU7XG4gIH0pKCkuY2F0Y2goKGVycikgPT4ge1xuICAgIHN0YXR1c1RleHQuc3R5bGUuY29sb3IgPSBcInZhcigtLWV4ZXJjaXNlLWVkaXRvci1obC1lciwgI0FEMDAwMClcIjtcbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gZXJyLm1lc3NhZ2U7XG4gICAgLy9pbmRpY2F0b3JDb250YWluZXIucXVlcnlTZWxlY3RvcihcIi5zcGlubmVyLWdyb3dcIikuY2xhc3NMaXN0LmFkZChcImQtbm9uZVwiKTtcbiAgICB0aHJvdyBlcnI7XG4gIH0pO1xuXG4gIC8vIEtlZXAgdHJhY2sgb2YgaW5pdGlhbCBPSlMgYmxvY2sgcmVuZGVyXG4gIGNvbnN0IHJlbmRlcmVkT2pzID0ge307XG5cbiAgY29uc3QgcHJvY2VzcyA9IGFzeW5jIChjb250ZXh0LCBpbnB1dHMpID0+IHtcbiAgICBjb25zdCBweW9kaWRlID0gYXdhaXQgcHlvZGlkZVByb21pc2U7XG4gICAgY29uc3QgZXZhbHVhdG9yID0gbmV3IFB5b2RpZGVFdmFsdWF0b3IocHlvZGlkZSwgY29udGV4dCk7XG4gICAgYXdhaXQgZXZhbHVhdG9yLnByb2Nlc3MoaW5wdXRzKTtcbiAgICByZXR1cm4gZXZhbHVhdG9yLmNvbnRhaW5lcjtcbiAgfVxuXG4gIHJldHVybiB7XG4gICAgcHlvZGlkZVByb21pc2UsXG4gICAgcmVuZGVyZWRPanMsXG4gICAgcHJvY2VzcyxcbiAgfTtcbn1cbiJ9XX0=
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
WyIuLi9zcmMvY2hhcHRlcjAucHkiXQ==
</script>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../trial-division";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../index.html" class="pagination-link" aria-label="Preface">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references/index.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>