<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>2&nbsp; Primality Testing – The Interactive Guide to Integer Factorization</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../references/index.html" rel="next">
<link href="../trial-division/index.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-d9ea66fcd6c317012447f26e9c021348.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="../site_libs/quarto-contrib/live-runtime/live-runtime.js" type="module"></script>
<link href="../site_libs/quarto-contrib/live-runtime/live-runtime.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="module" src="../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script>
<link href="../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../primality-testing/index.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Primality Testing</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../" class="sidebar-logo-link">
      <img src="../cover.png" alt="The Interactive Guide to Integer Factorization cover" class="sidebar-logo light-content py-0 d-lg-inline d-none">
      <img src="../cover.png" alt="The Interactive Guide to Integer Factorization cover" class="sidebar-logo dark-content py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">The Interactive Guide to Integer Factorization</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../trial-division/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Trial Division</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../primality-testing/index.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Primality Testing</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../references/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-fermat-primality-test" id="toc-sec-fermat-primality-test" class="nav-link active" data-scroll-target="#sec-fermat-primality-test"><span class="header-section-number">2.1</span> Fermat primality test</a>
  <ul class="collapse">
  <li><a href="#congruence-modulo-n-notation" id="toc-congruence-modulo-n-notation" class="nav-link" data-scroll-target="#congruence-modulo-n-notation"><span class="header-section-number">2.1.1</span> Congruence modulo n notation</a></li>
  </ul></li>
  <li><a href="#miller-rabin-to-the-rescue" id="toc-miller-rabin-to-the-rescue" class="nav-link" data-scroll-target="#miller-rabin-to-the-rescue"><span class="header-section-number">2.2</span> Miller-Rabin to the rescue</a></li>
  <li><a href="#sec-modular-exponentiation" id="toc-sec-modular-exponentiation" class="nav-link" data-scroll-target="#sec-modular-exponentiation"><span class="header-section-number">2.3</span> Speeding up exponentiation mod n</a></li>
  <li><a href="#primality-certificates" id="toc-primality-certificates" class="nav-link" data-scroll-target="#primality-certificates"><span class="header-section-number">2.4</span> Primality certificates</a>
  <ul class="collapse">
  <li><a href="#pratt-certificates" id="toc-pratt-certificates" class="nav-link" data-scroll-target="#pratt-certificates"><span class="header-section-number">2.4.1</span> Pratt certificates</a></li>
  <li><a href="#the-group-mathbbz_p" id="toc-the-group-mathbbz_p" class="nav-link" data-scroll-target="#the-group-mathbbz_p"><span class="header-section-number">2.4.2</span> The group <span class="math inline">\(\mathbb{Z}_p^*\)</span></a></li>
  <li><a href="#order-of-an-element-and-lagranges-theorem" id="toc-order-of-an-element-and-lagranges-theorem" class="nav-link" data-scroll-target="#order-of-an-element-and-lagranges-theorem"><span class="header-section-number">2.4.3</span> Order of an element and Lagrange’s theorem</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Primality Testing</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In <a href="../trial-division/index.html" class="quarto-xref"><span>Chapter 1</span></a> we saw that often the worst-case input for trial division was prime numbers: to rule out that these had any nontrivial factors, we had to test every single prime factor between 2 and <span class="math inline">\(\sqrt{n}\)</span>. This is a problem because many numbers that we wish to factor in practice have a form like this, where there are many small factors but one big factor:</p>
<p>62104940417054684654 = 2 × 17 × 541 × 1223 × 2760727302517</p>
<p>With our approach so far, we’d spend most of our runtime just ensuring that the large cofactor 2760727302517 is in fact prime:</p>
<div>
<div id="pyodide-1" class="exercise-cell">

</div>
<script type="pyodide-1-contents">
eyJhdHRyIjp7ImF1dG9ydW4iOnRydWUsImVkaXQiOmZhbHNlLCJldmFsIjp0cnVlLCJvdXRwdXQiOmZhbHNlLCJydW5idXR0b24iOmZhbHNlfSwiY29kZSI6ImltcG9ydCBzeXNcbmlmIFwic3JjXCIgbm90IGluIHN5cy5wYXRoOlxuICAgIHN5cy5wYXRoLmluc2VydCgwLCBcInNyY1wiKSJ9
</script>
</div>
<div>
<div id="pyodide-2" class="exercise-cell">

</div>
<script type="pyodide-2-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZnJvbSBjaGFwdGVyMSBpbXBvcnQgdHJpYWxfZGl2aXNpb25fd2hlZWxfMzAwMzBcbmltcG9ydCB0aW1laXRcblxubiA9IDYyMTA0OTQwNDE3MDU0Njg0NjU0XG53aGlsZSBuICE9IDE6XG4gICAgZiA9IHRyaWFsX2RpdmlzaW9uX3doZWVsXzMwMDMwKG4pXG4gICAgdCA9IHRpbWVpdC50aW1laXQobGFtYmRhOiB0cmlhbF9kaXZpc2lvbl93aGVlbF8zMDAzMChuKSwgbnVtYmVyPTEwKVxuICAgIHByaW50KGZcIkZvdW5kIGZhY3RvciB7Zn0gaW4gdGltZSB7dH1cIilcbiAgICBuIC8vPSBmIn0=
</script>
</div>
<p>But what if there were a way to determine if a number is prime quickly without having to test all possible factors? The main idea is: if we can find mathematical properties that prime numbers satisfy but composite numbers don’t, we can use that to differentiate them.</p>
<section id="sec-fermat-primality-test" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="sec-fermat-primality-test"><span class="header-section-number">2.1</span> Fermat primality test</h2>
<p>Our first primality test is based on <strong>Fermat’s Little Theorem</strong>, which states that:</p>
<ul>
<li>If <em>p</em> is prime and 1 &lt; <em>a</em> &lt; <em>p</em>, then a<sup>p</sup> % <em>p</em> = a. (where % is remainder after division)</li>
</ul>
<p>For example, given the prime <em>p</em> = 11 and <em>a</em> = 2, we can compute 2<sup>11</sup> % 11 = 2048 % 11 = 2. The contrapositive is also true:</p>
<ul>
<li>If 1 &lt; <em>a</em> &lt; <em>n</em> and <em>a</em><sup>n</sup> % <em>n</em> ≠ <em>a</em>, then <em>n</em> is composite. An <em>a</em> satisfying this is called a <em>witness</em>.</li>
</ul>
<p>For example, 2<sup>15</sup> % 15 = 32768 % 15 = 8 ≠ 2, showing 15 is composite (and 2 is a witness). Note that this doesn’t tell us any factor of 15, only that it <em>has</em> factors.</p>
<p>We begin by investigating a<sup>n</sup> for various <em>a</em> and <em>n</em> to see when the property <code>a**n % n == a</code> is satisfied. For efficiency we replace <code>a**n % n</code> by the much faster equivalent <code>pow(a, n, n)</code> ― we will explore in <a href="#sec-modular-exponentiation" class="quarto-xref"><span>Section 2.3</span></a> how <code>pow()</code> works in detail.</p>
<div>
<div id="pyodide-3" class="exercise-cell">

</div>
<script type="pyodide-3-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHRlc3RfZmVybWF0X3Byb3BlcnR5KG4pOlxuICAgIHByaW50KGZcIlxcbntufTogXCIsIGVuZD1cIlwiKVxuICAgIGZvciBhIGluIHJhbmdlKDIsIG4tMSk6XG4gICAgICAgIGlmIHBvdyhhLCBuLCBuKSA9PSBhOiAgIyBhKipuICUgbiA9PSBhXG4gICAgICAgICAgICBwcmludChcIlRcIiwgZW5kPVwiXCIpXG4gICAgICAgIGVsc2U6XG4gICAgICAgICAgICBwcmludChcIkZcIiwgZW5kPVwiXCIpXG4gICAgcHJpbnQoKVxuXG5mb3IgbiBpbiBbMTEsIDEzLCAxNSwgMjQsIDMxLCAzNV06XG4gICAgdGVzdF9mZXJtYXRfcHJvcGVydHkobikifQ==
</script>
</div>
<p>For primes like 11, 13, and 31, the property is always true. For most composite numbers like 15, 24, and 35, the property is false for at least half of all possible <em>a</em> values. There is no simple way to compute a witness <em>a</em> value such that <em>a</em><sup>n</sup> % <em>n</em> ≠ <em>a</em>. But because at least half the possible <em>a</em> will work, it’s sufficient to just try random values of <em>a</em>. Each gives us a ≥50% chance of finding a witness, so after trying maybe 30 different values, the chance of failing to find one is &lt; 1/2<sup>30</sup>, incredibly unlikely. This gives us a fast randomized primality test:</p>
<div>
<div id="pyodide-4" class="exercise-cell">

</div>
<script type="pyodide-4-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHJhbmRvbVxuXG5kZWYgaXNfcHJpbWVfZmVybWF0KG4pOlxuICAgIGZvciBpIGluIHJhbmdlKDMwKTpcbiAgICAgICAgYSA9IHJhbmRvbS5yYW5kaW50KDIsbi0xKVxuICAgICAgICBpZiBwb3coYSwgbiwgbikgIT0gYTpcbiAgICAgICAgICAgIHJldHVybiBGYWxzZVxuICAgIHJldHVybiBUcnVlXG5cbmZvciBuIGluIFsxMSwgMTMsIDE1LCAyNCwgMzEsIDM1XTpcbiAgICBwcmludChmXCJ7bn0gcHJpbWU6IHtpc19wcmltZV9mZXJtYXQobil9XCIpIn0=
</script>
</div>
<p>It can seem strange at first to accept a small chance of failure. However, in the real world hardware failures causing incorrect results are much more likely than 1/2<sup>30</sup>, so this is not an issue in practice.</p>
<p>Unfortunately, there is a bigger problem with this test: there are certain special composite numbers <em>n</em> called Carmichael numbers (like 561 = 3 × 11 × 17) that always satisfy the Fermat property for all <em>a</em>, just like a prime number, and it will incorrectly return <code>True</code> for these:</p>
<div>
<div id="pyodide-5" class="exercise-cell">

</div>
<script type="pyodide-5-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoidGVzdF9mZXJtYXRfcHJvcGVydHkoNTYxKVxuaXNfcHJpbWVfZmVybWF0KDU2MSkifQ==
</script>
</div>
<section id="congruence-modulo-n-notation" class="level3" data-number="2.1.1">
<h3 data-number="2.1.1" class="anchored" data-anchor-id="congruence-modulo-n-notation"><span class="header-section-number">2.1.1</span> Congruence modulo n notation</h3>
<p>Before proceeding, to make it easier to discuss remainders, we introduce this standard math notation for <strong>congruence modulo n</strong>:</p>
<p><span class="math display">\[ a \equiv b \pmod{n} \]</span></p>
<p>This simply means <code>a % n == b % n</code>. For example:</p>
<ul>
<li>17 ☰ 5 (mod 4) (because <code>17 % 4 == 5 % 4 == 1</code>)</li>
<li>5 ☰ 2 (mod 3) (because <code>5 % 3 == 2 % 3 == 2</code>)</li>
<li>15 ☰ 0 (mod 5) (because <code>15 % 5 == 0 % 5 == 0</code>)</li>
</ul>
<p>A congruence like this is a lot like an equation: as long as we add, subtract, or multiply both sides by the same number, it will remain true. Dividing both sides by the same number is also allowed, but <em>only under the condition</em> that the divisor and <em>n</em> have no factors in common. Otherwise something like this can happen:</p>
<ul>
<li>30 ☰ 15 (mod 5) ✅</li>
<li>6 ☰ 3 (mod 5) ❌ (breaks when dividing both sides by 5)</li>
<li>10 ☰ 5 (mod 5) ✅ (dividing both sides by 3 is okay, 3 has no factors in common with 5)</li>
</ul>
<p>Using this notation, we can rewrite Fermat’s Little Theorem like this:</p>
<p><span class="math display">\[ p\text{ prime}, 1 &lt; a &lt; p \implies a^p \equiv a \pmod p \]</span></p>
<p>If we divide both sides by <em>a</em> (which shares no factors with <em>p</em>) we also get this common form which we’ll use in the next section:</p>
<p><span class="math display">\[ p\text{ prime}, 1 &lt; a &lt; p \implies a^{p-1} \equiv 1 \pmod p \]</span></p>
</section>
</section>
<section id="miller-rabin-to-the-rescue" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="miller-rabin-to-the-rescue"><span class="header-section-number">2.2</span> Miller-Rabin to the rescue</h2>
<p>Because Fermat’s Little Theorem cannot distinguish Carmichael numbers from primes, we need a new theorem that can, so we introduce the <strong>Square Roots of Unity Property</strong>:</p>
<ul>
<li>If <em>p</em> is prime, then for all 2 ≤ <em>x</em> ≤ <em>p</em>−2, <em>x</em><sup>2</sup> ☰ 1 (mod <em>p</em>)</li>
</ul>
<p>A value <em>x</em> such that <em>x</em><sup>2</sup> ☰ 1 (mod <em>p</em>) is called a <strong>square root of unity</strong>. The values 1 and <em>p</em>−1 are always square roots of unity (the trivial roots). The above property states that there are no others.</p>
<p>Proof: If <em>x</em><sup>2</sup> ☰ 1 (mod <em>p</em>), that means <em>x</em><sup>2</sup> − 1 = (<em>x</em> − 1)(<em>x</em> + 1) is divisible by <em>p</em>. And if a prime <em>p</em> divides a product, it must divide either one factor or the other. This implies either <em>x</em> ☰ 1 (mod <em>p</em>) or <em>x</em> ☰ −1 (mod <em>p</em>). Either way it’s not between 2 and <em>p</em>−2.</p>
<p>To explore this property, we’ll list all the square roots of unity for various <em>n</em>:</p>
<div>
<div id="pyodide-6" class="exercise-cell">

</div>
<script type="pyodide-6-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHNxcnRzX29mX3VuaXR5KG4pOlxuICAgIHJldHVybiBbYSBmb3IgYSBpbiByYW5nZSgwLCBuKSBpZiBhKmEgJSBuID09IDFdXG5cbmZvciBuIGluIFsxMSwgMTMsIDE1LCAyNCwgMzEsIDM1LCA1NjFdOlxuICAgIHByaW50KGZcIntufToge3NxcnRzX29mX3VuaXR5KG4pfVwiKSJ9
</script>
</div>
<p>This property can detect any composite number. However, roots of unity are much sparser than Fermat witnesses, so we can’t just choose <em>a</em> at random and hope to find one. We need a different strategy.</p>
<p>We’ll walk through an example with the Carmichael number 561 and the witness <em>a</em>=2. We first do the Fermat test using <em>a</em><sup>n-1</sup> ☰ 1 (mod <em>n</em>):</p>
<ul>
<li>2<sup>560</sup> ☰ 1 (mod 561)</li>
</ul>
<p>As expected, the Fermat test is inconclusive. But because 560/2 = 280, we can write:</p>
<ul>
<li>(2<sup>280</sup>)<sup>2</sup> ☰ 1 (mod 561)</li>
</ul>
<p>This means 2<sup>280</sup> is a square root of unity! Unfortunately, it turns out it’s equivalent to 1, making it a trivial square root of unity:</p>
<ul>
<li>2<sup>280</sup> ☰ 1 (mod 561)</li>
</ul>
<p>But because 280/2 = 140, we can repeat this same trick to find that 2<sup>140</sup> is a square root of unity. And this one it turns out is nontrivial:</p>
<ul>
<li>2<sup>140</sup> ☰ 67 (mod 561)</li>
</ul>
<p>Since 67<sup>2</sup> ☰ 1 (mod 561), this proves 561 is composite. But what if instead of <em>a</em>=2 we used <em>a</em>=101? In this case we would have found:</p>
<ul>
<li>101<sup>560</sup> ☰ 1 (mod 561)</li>
<li>101<sup>280</sup> ☰ 1 (mod 561)</li>
<li>101<sup>140</sup> ☰ 1 (mod 561)</li>
<li>101<sup>70</sup> ☰ 1 (mod 561)</li>
<li>101<sup>35</sup> ☰ 560 (mod 561)</li>
</ul>
<p>Since 560 = <em>p</em>-1, all of these are trivial square roots of unity. And we can’t continue because 35 is odd. Additionally, once we reach the trivial square root <em>p</em>-1, the next step will no longer be a square root of unity, so we’re stuck. This kind of <em>a</em> that fails to show that <em>n</em> is composite is called a <strong>strong liar</strong>.</p>
<p>Fortunately, it can be shown that at most 25% of possible <em>a</em> values are strong liars. This means that if we take about 20 values of <em>a</em> at random, the probability of failure will be extremely low:</p>
<div>
<div id="pyodide-7" class="exercise-cell">

</div>
<script type="pyodide-7-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHJhbmRvbVxuXG5kZWYgaXNfcHJpbWVfc3FydF91bml0eShuKTpcbiAgICBmb3IgaSBpbiByYW5nZSgyMCk6XG4gICAgICAgIGEgPSByYW5kb20ucmFuZGludCgyLG4tMSlcbiAgICAgICAgZXhwb25lbnQgPSBuLTFcbiAgICAgICAgaWYgcG93KGEsIGV4cG9uZW50LCBuKSAhPSAxOlxuICAgICAgICAgICAgcmV0dXJuIEZhbHNlXG4gICAgICAgIHdoaWxlIGV4cG9uZW50ICUgMiA9PSAwOlxuICAgICAgICAgICAgZXhwb25lbnQgLy89IDJcbiAgICAgICAgICAgIGFfdG9fZXhwID0gcG93KGEsIGV4cG9uZW50LCBuKVxuICAgICAgICAgICAgaWYgYV90b19leHAgIT0gMSBhbmQgYV90b19leHAgIT0gbi0xOlxuICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZVxuICAgICAgICAgICAgaWYgYV90b19leHAgPT0gbi0xOlxuICAgICAgICAgICAgICAgIGJyZWFrXG4gICAgcmV0dXJuIFRydWVcblxuZm9yIG4gaW4gWzExLCAxMywgMTUsIDI0LCAzMSwgMzVdOlxuICAgIHByaW50KGZcIntufSBwcmltZToge2lzX3ByaW1lX3NxcnRfdW5pdHkobil9XCIpXG5mb3IgbiBpbiBbNTYxLCAxMTA1LCAxNzI5XTogIyBDYXJtaWNoYWVsIG51bWJlcnNcbiAgICBwcmludChmXCJ7bn0gcHJpbWU6IHtpc19wcmltZV9zcXJ0X3VuaXR5KG4pfVwiKSJ9
</script>
</div>
<p>This algorithm works well, but performs more operations than necessary. Miller-Rabin algorithm optimizes it by going in the opposite direction: instead of starting at <em>a</em><sup>n-1</sup> and successively dividing the exponent by 2, it instead divides all the 2’s out of the exponent at the beginning and then multiplies them back in one at a time until reaching <em>n</em>-1. For example, with <em>a</em>=2 and <em>p</em>=561:</p>
<p><em>n</em> - 1 = 560 = 2<sup>4</sup> × 35</p>
<p>((((2<sup>35</sup>)<sup>2</sup>)<sup>2</sup>)<sup>2</sup>)<sup>2</sup> = 2<sup>560</sup></p>
<p>In other words, if we take 2<sup>35</sup> mod 561, and square it four times mod 561, we will get 2<sup>560</sup>. If anywhere along the way we encounter 1, that means the previous number in the sequence is a square root of unity:</p>
<ul>
<li>2<sup>35</sup> ☰ 263 (mod 561)</li>
<li>2<sup>70</sup> ☰ 263<sup>2</sup> ☰ 166 (mod 561)</li>
<li>2<sup>140</sup> ☰ 166<sup>2</sup> ☰ 140 (mod 561)</li>
<li>2<sup>280</sup> ☰ 140<sup>2</sup> ☰ 1 (mod 561)</li>
<li>2<sup>560</sup> ☰ 1<sup>2</sup> ☰ 1 (mod 561)</li>
</ul>
<p>Because 140<sup>2</sup> ☰ 1 (mod 561), we have a nontrivial root of unity and 561 is composite. If <em>a</em>=101 on the other hand:</p>
<ul>
<li>101<sup>35</sup> ☰ 560 (mod 561)</li>
<li>101<sup>70</sup> ☰ 560<sup>2</sup> ☰ 1 (mod 561)</li>
<li>101<sup>140</sup> ☰ 1<sup>2</sup> ☰ 1 (mod 561)</li>
<li>101<sup>280</sup> ☰ 1<sup>2</sup> ☰ 1 (mod 561)</li>
<li>101<sup>560</sup> ☰ 1<sup>2</sup> ☰ 1 (mod 561)</li>
</ul>
<p>Only 1 and <em>n</em>-1 appear, so the test is inconclusive, and we must try a different <em>a</em>.</p>
<p>One final example with <em>a</em>=2 and <em>n</em>=453:</p>
<p><em>n</em> - 1 = 452 = 2<sup>2</sup> × 113</p>
<ul>
<li>2<sup>113</sup> ☰ 407 (mod 453)</li>
<li>2<sup>226</sup> ☰ 407<sup>2</sup> ☰ 226 (mod 453)</li>
<li>2<sup>452</sup> ☰ 226<sup>2</sup> ☰ 4 (mod 453)</li>
</ul>
<p>Because we made it to 2<sup>n-1</sup> without seeing 1, the number is composite (by Fermat’s Little Theorem). Using this idea, we can now implement Miller-Rabin:</p>
<div>
<div id="pyodide-8" class="exercise-cell">

</div>
<script type="pyodide-8-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHJhbmRvbVxuXG5kZWYgaXNfcHJpbWVfbWlsbGVyX3JhYmluKG4pOlxuICAgIGZvciBpIGluIHJhbmdlKDIwKTpcbiAgICAgICAgYSA9IHJhbmRvbS5yYW5kaW50KDIsbi0xKVxuXG4gICAgICAgICMgV3JpdGUgbi0xIGFzIDJecyAqIGQgd2l0aCBkIG9kZFxuICAgICAgICBkID0gbi0xXG4gICAgICAgIHMgPSAwXG4gICAgICAgIHdoaWxlIGQgJSAyID09IDA6XG4gICAgICAgICAgICBkIC8vPSAyXG4gICAgICAgICAgICBzICs9IDFcblxuICAgICAgICBhX3Bvd2VyID0gcG93KGEsIGQsIG4pXG4gICAgICAgIGZvciBpIGluIHJhbmdlKHMpOlxuICAgICAgICAgICAgcHJldl9hX3Bvd2VyID0gYV9wb3dlclxuICAgICAgICAgICAgYV9wb3dlciA9IChhX3Bvd2VyICogYV9wb3dlcikgJSBuXG4gICAgICAgICAgICBpZiBhX3Bvd2VyID09IDEgYW5kIFxcXG4gICAgICAgICAgICAgICBwcmV2X2FfcG93ZXIgIT0gMSBhbmQgcHJldl9hX3Bvd2VyICE9IG4tMTpcbiAgICAgICAgICAgICAgICAjIEZvdW5kIGEgbm9udHJpdmlhbCBzcXVhcmUgcm9vdCBvZiB1bml0eVxuICAgICAgICAgICAgICAgIHJldHVybiBGYWxzZVxuXG4gICAgICAgICMgYV9wb3dlciBpcyBub3cgYV5uLTFeLCBydW4gRmVybWF0IHRlc3RcbiAgICAgICAgaWYgYV9wb3dlciAhPSAxOlxuICAgICAgICAgICAgcmV0dXJuIEZhbHNlXG4gICAgcmV0dXJuIFRydWVcblxuZm9yIG4gaW4gWzExLCAxMywgMTUsIDI0LCAzMSwgMzVdOlxuICAgIHByaW50KGZcIntufSBwcmltZToge2lzX3ByaW1lX21pbGxlcl9yYWJpbihuKX1cIilcbmZvciBuIGluIFs1NjEsIDExMDUsIDE3MjldOiAjIENhcm1pY2hhZWwgbnVtYmVyc1xuICAgIHByaW50KGZcIntufSBwcmltZToge2lzX3ByaW1lX21pbGxlcl9yYWJpbihuKX1cIikifQ==
</script>
</div>
<p>The clever thing about Miller-Rabin is that, as we will see below in <a href="#sec-modular-exponentiation" class="quarto-xref"><span>Section 2.3</span></a>, all these squaring operations are actually needed to compute <em>a</em><sup>n-1</sup> mod <em>n</em> anyway. By simply taking a peek at the intermediate results of this computation, it’s able to solve the Carmichael number problem and provide a reliable test with no additional work.</p>
</section>
<section id="sec-modular-exponentiation" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="sec-modular-exponentiation"><span class="header-section-number">2.3</span> Speeding up exponentiation mod n</h2>
<p>When running Miller-Rabin on a prime like 179424893 with witness <em>a</em>=2, we need to compute <code>2**44856223 % 179424893</code>. The final result 117471984 is manageable, but the intermediate result <code>2**44856223</code> has over 13 million digits, making this very slow. We’ve been using Python’s built-in <code>pow()</code> which can do this quickly, but how does it work?</p>
<p>Let’s start with a simpler example. Suppose we want 2<sup>1000000</sup> mod 13. By splitting up 1000000 into 10 × 10 × 10 × 10 × 10 × 10, we can split up the computation like this:</p>
<p>2<sup>1000000</sup> = (((((2<sup>10</sup>)<sup>10</sup>)<sup>10</sup>)<sup>10</sup>)<sup>10</sup>)<sup>10</sup></p>
<p>By taking % 13 after each step, all of our intermediate results remain small, and the computation is dramatically faster:</p>
<div>
<div id="pyodide-9" class="exercise-cell">

</div>
<script type="pyodide-9-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdFxucHJpbnQodGltZWl0LnRpbWVpdChsYW1iZGE6IDIqKjEwMDAwMDAgJSAxMywgbnVtYmVyPTEwKS8xMClcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiBcXFxuICAgICgoKCgoMioqMTAgJSAxMykqKjEwICUgMTMpKioxMCAlIDEzKSoqMTAgJSAxMykqKjEwICUgMTMpKioxMCAlIDEzLCBudW1iZXI9MTAwMDAwKS8xMDAwMDApIn0=
</script>
</div>
<p>With a more complex power like 2<sup>547</sup>, we can break it down like this:</p>
<p>547 = (((5 × 10) + 4) × 10) + 7</p>
<p>2<sup>547</sup> = ((2<sup>5</sup>)<sup>10</sup> × 2<sup>4</sup>)<sup>10</sup> × 2<sup>7</sup></p>
<p>This suggests a general solution. We extract the decimal digits of the power <em>k</em> and then alternate between exponentiating by 10 and multiplying by <code>a**digit</code> for each digit:</p>
<div>
<div id="pyodide-10" class="exercise-cell">

</div>
<script type="pyodide-10-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdFxuXG4jIEZpbmQgYSoqayAlIG5cbmRlZiBwb3dlcl9tb2RfZGVjaW1hbChhLCBrLCBuKTpcbiAgICBkaWdpdHMgPSBbXVxuICAgIHdoaWxlIGsgPiAwOlxuICAgICAgICBkaWdpdHMuYXBwZW5kKGsgJSAxMClcbiAgICAgICAgayAvLz0gMTBcbiAgICBkaWdpdHMucmV2ZXJzZSgpXG5cbiAgICByZXN1bHQgPSAxXG4gICAgZm9yIGRpZ2l0IGluIGRpZ2l0czpcbiAgICAgICAgcmVzdWx0ICoqPSAxMFxuICAgICAgICByZXN1bHQgKj0gYSoqZGlnaXRcbiAgICAgICAgcmVzdWx0ICU9IG5cbiAgICByZXR1cm4gcmVzdWx0XG5cbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiAyKioxMjM0NTY3ODkgJSAxMywgbnVtYmVyPTEpKVxucHJpbnQodGltZWl0LnRpbWVpdChsYW1iZGE6IHBvd2VyX21vZF9kZWNpbWFsKDIsIDEyMzQ1Njc4OSwgMTMpLCBudW1iZXI9MTAwMCkvMTAwMClcbigyKioxMjM0NTY3ODkgJSAxMywgcG93ZXJfbW9kX2RlY2ltYWwoMiwgMTIzNDU2Nzg5LCAxMykpIn0=
</script>
</div>
<p>This works well, but improvements can be made by switching from base 10 to another base. Which base is optimal depends on the precise input parameters, but binary has some big advantages for large inputs:</p>
<ul>
<li>Extracting the digits from <em>k</em> with bit operations is fast.</li>
<li>Exponentiation by 2 can be replaced with a single multiplication.</li>
<li>Most importantly, the size of intermediate results never exceeds <em>n</em><sup>2</sup>.</li>
</ul>
<div>
<div id="pyodide-11" class="exercise-cell">

</div>
<script type="pyodide-11-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiaW1wb3J0IHRpbWVpdFxuXG5kZWYgcG93ZXJfbW9kX2JpbmFyeShhLCBrLCBuKTpcbiAgICBkaWdpdHMgPSBbXVxuICAgIHdoaWxlIGsgPiAwOlxuICAgICAgICBkaWdpdHMuYXBwZW5kKGsgJiAxKVxuICAgICAgICBrID4+PSAxXG4gICAgZGlnaXRzLnJldmVyc2UoKVxuXG4gICAgcmVzdWx0ID0gMVxuICAgIGZvciBkaWdpdCBpbiBkaWdpdHM6XG4gICAgICAgIHJlc3VsdCAqPSByZXN1bHRcbiAgICAgICAgaWYgZGlnaXQ6XG4gICAgICAgICAgICByZXN1bHQgJT0gblxuICAgICAgICAgICAgcmVzdWx0ICo9IGFcbiAgICAgICAgcmVzdWx0ICU9IG5cbiAgICByZXR1cm4gcmVzdWx0XG5cbmEsIGssIG4gPSAyLCAxMjM0NTY3ODksIDEzXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogcG93ZXJfbW9kX2RlY2ltYWwoYSwgaywgbiksIG51bWJlcj0xMDAwMCkpXG5wcmludCh0aW1laXQudGltZWl0KGxhbWJkYTogcG93ZXJfbW9kX2JpbmFyeShhLCBrLCBuKSwgbnVtYmVyPTEwMDAwKSlcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiBwb3coYSwgaywgbiksIG51bWJlcj0xMDAwMCkpXG5wcmludCgpXG5hLCBrLCBuID0gMTAqKjEwMDAvLzIgLSAzLCAxMCoqMTAwMCwgMTAqKjEwMDBcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiBwb3dlcl9tb2RfZGVjaW1hbChhLCBrLCBuKSwgbnVtYmVyPTEpKVxucHJpbnQodGltZWl0LnRpbWVpdChsYW1iZGE6IHBvd2VyX21vZF9iaW5hcnkoYSwgaywgbiksIG51bWJlcj0xKSlcbnByaW50KHRpbWVpdC50aW1laXQobGFtYmRhOiBwb3coYSwgaywgbiksIG51bWJlcj0xKSlcbihwb3dlcl9tb2RfYmluYXJ5KGEsIGssIG4pLCBwb3coYSwgaywgbikpIn0=
</script>
</div>
<p>On small inputs, the large digit count of the binary version creates substantial overhead, but on large inputs, its smaller intermediate results allow it to even approach the performance of <code>pow()</code>.</p>
<p>Notice how both <code>power_mod_binary()</code> and <code>is_prime_miller_rabin()</code> use squaring to double an exponent. This technique will be common in many algorithms.</p>
</section>
<section id="primality-certificates" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="primality-certificates"><span class="header-section-number">2.4</span> Primality certificates</h2>
<p>In practice, the chance of Miller-Rabin failing is so tiny as to be irrelevant. But in certain special applications, it’s still useful to be able to prove with certainty that a number is prime. Although there are deterministic algorithms to determine if a number is prime with certainty (the AKS algorithm), these are impractical for real-world use.</p>
<p>Instead, we’ll pursue a different approach where we construct a <strong>primality certificate</strong>, a set of information that anyone can use to quickly verify that a given number is prime. Verifying that the certificate is valid is easy and fast, but finding it is difficult and requires some advanced techniques and heuristics.</p>
<section id="pratt-certificates" class="level3" data-number="2.4.1">
<h3 data-number="2.4.1" class="anchored" data-anchor-id="pratt-certificates"><span class="header-section-number">2.4.1</span> Pratt certificates</h3>
<p>The simplest kind of primality certificate is the Pratt certificate. It’s based on Lucas’s theorem, which states that if the following two conditions are true for some witness <em>a</em>, then <em>n</em> is prime:</p>
<ul>
<li><em>a</em><sup>n−1</sup> ☰ 1 (mod <em>n</em>)</li>
<li>For every prime factor <em>q</em> of <em>n</em>, we have <span class="math inline">\(a^{(n-1)/q} \not\equiv 1 \pmod n\)</span>.</li>
</ul>
<p>For example, take <em>n</em> = 15485863. This number is prime, but to prove it using the theorem above, I have to tell you what <em>a</em> is, and tell you the prime factorization of <em>n</em>-1:</p>
<p>15485863: <em>a</em> = 6, 15485862 = 2 × 3 × 7<sup>2</sup> × 52673</p>
<p>Given this information, checking it is simple:</p>
<div>
<div id="pyodide-12" class="exercise-cell">

</div>
<script type="pyodide-12-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHByYXR0X2NlcnRpZmljYXRlX2lzX3ZhbGlkKG4sIGEsIG5fbWludXNfb25lX3ByaW1lX2ZhY3RvcnMpOlxuICAgICMgVmVyaWZ5IHRoZSBmYWN0b3JzIG11bHRpcGx5IHRvIG4tMVxuICAgIHByb2R1Y3QgPSAxXG4gICAgZm9yIFtxLGVdIGluIG5fbWludXNfb25lX3ByaW1lX2ZhY3RvcnM6XG4gICAgICAgIHByb2R1Y3QgKj0gcSoqZVxuICAgIGlmIHByb2R1Y3QgIT0gbi0xOlxuICAgICAgICByZXR1cm4gRmFsc2VcblxuICAgICMgVmVyaWZ5IG1vZHVsYXIgY29uZGl0aW9uc1xuICAgIGlmIHBvdyhhLCBuLTEsIG4pICE9IDE6XG4gICAgICAgIHJldHVybiBGYWxzZVxuICAgIGZvciBbcSxfXSBpbiBuX21pbnVzX29uZV9wcmltZV9mYWN0b3JzOlxuICAgICAgICBpZiBwb3coYSwgKG4tMSkvL3EsIG4pID09IDE6XG4gICAgICAgICAgICByZXR1cm4gRmFsc2VcbiAgICByZXR1cm4gVHJ1ZVxuXG5wcmF0dF9jZXJ0aWZpY2F0ZV9pc192YWxpZChcbiAgICAxNTQ4NTg2MywgNiwgW1syLDFdLCBbMywxXSwgWzcsMl0sIFs1MjY3MywgMV1dKSJ9
</script>
</div>
<p>There is however a problem with this verifier: it trusts that the prime factors of <em>n</em>−1 that you gave it are actually prime. This makes it possible to trick it into accepting a composite number by giving it a composite factor:</p>
<div>
<div id="pyodide-13" class="exercise-cell">

</div>
<script type="pyodide-13-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiIyBSZXR1cm5zIFRydWUsIGJ1dCAzNDEgPSAxMSAqIDMxIGlzIGNvbXBvc2l0ZVxucHJhdHRfY2VydGlmaWNhdGVfaXNfdmFsaWQoMzQxLCAyLCBbWzUsMV0sWzY4LDFdXSkifQ==
</script>
</div>
<p>The verifier could test if the factors are prime, but if they’re large, this could be expensive. Instead, we provide Pratt certificates for the prime factors as well. We continue this recursively until we get a number small enough to check manually:</p>
<div>
<div id="pyodide-14" class="exercise-cell">

</div>
<script type="pyodide-14-contents">
eyJhdHRyIjp7ImVkaXQiOnRydWUsImV2YWwiOnRydWV9LCJjb2RlIjoiZGVmIHByYXR0X2NlcnRpZmljYXRlX2lzX3ZhbGlkX3JlY3Vyc2l2ZShuLCBjZXJ0aWZpY2F0ZV9tYXApOlxuICAgIHNtYWxsX3ByaW1lcyA9IFsyLCAzLCA1LCA3LCAxMSwgMTMsIDE3LCAxOV1cbiAgICBpZiBuIDw9IHNtYWxsX3ByaW1lc1stMV0gYW5kIG4gaW4gc21hbGxfcHJpbWVzOlxuICAgICAgICByZXR1cm4gVHJ1ZSAgIyBCYXNlIGNhc2VcbiAgICBcbiAgICBpZiBuIG5vdCBpbiBjZXJ0aWZpY2F0ZV9tYXA6XG4gICAgICAgIHJldHVybiBGYWxzZSAgIyBNaXNzaW5nIGNlcnRpZmljYXRlXG5cbiAgICAoYSwgbl9taW51c19vbmVfcHJpbWVfZmFjdG9ycykgPSBjZXJ0aWZpY2F0ZV9tYXBbbl1cblxuICAgICMgVmVyaWZ5IHRoZSBmYWN0b3JzIG11bHRpcGx5IHRvIG4tMVxuICAgIHByb2R1Y3QgPSAxXG4gICAgZm9yIFtxLGVdIGluIG5fbWludXNfb25lX3ByaW1lX2ZhY3RvcnM6XG4gICAgICAgIHByb2R1Y3QgKj0gcSoqZVxuICAgIGlmIHByb2R1Y3QgIT0gbi0xOlxuICAgICAgICByZXR1cm4gRmFsc2VcblxuICAgICMgVmVyaWZ5IG1vZHVsYXIgY29uZGl0aW9uc1xuICAgIGlmIHBvdyhhLCBuLTEsIG4pICE9IDE6XG4gICAgICAgIHJldHVybiBGYWxzZVxuICAgIGZvciBbcSxfXSBpbiBuX21pbnVzX29uZV9wcmltZV9mYWN0b3JzOlxuICAgICAgICBpZiBwb3coYSwgKG4tMSkvL3EsIG4pID09IDE6XG4gICAgICAgICAgICByZXR1cm4gRmFsc2VcblxuICAgICMgVmVyaWZ5IHByaW1hbGl0eSBvZiBlYWNoIGZhY3RvciByZWN1cnNpdmVseVxuICAgIGZvciBbcSxfXSBpbiBuX21pbnVzX29uZV9wcmltZV9mYWN0b3JzOlxuICAgICAgICBpZiBub3QgcHJhdHRfY2VydGlmaWNhdGVfaXNfdmFsaWRfcmVjdXJzaXZlKHEsIGNlcnRpZmljYXRlX21hcCk6XG4gICAgICAgICAgICByZXR1cm4gRmFsc2VcblxuICAgIHJldHVybiBUcnVlXG5cbnByYXR0X2NlcnRpZmljYXRlX2lzX3ZhbGlkX3JlY3Vyc2l2ZShcbiAgICAxNTQ4NTg2MyxcbiAgICB7XG4gICAgICAgIDE1NDg1ODYzOiAoNiwgW1syLDFdLCBbMywxXSwgWzcsMl0sIFs1MjY3MywgMV1dKSxcbiAgICAgICAgNTI2NzM6ICgzLCBbWzIsIDZdLCBbODIzLCAxXV0pLFxuICAgICAgICA4MjM6ICgzLCBbWzIsMV0sIFszLDFdLCBbMTM3LCAxXV0pLFxuICAgICAgICAxMzc6ICgzLCBbWzIsM10sIFsxNywxXV0pXG4gICAgfSkifQ==
</script>
</div>
<p>Using this scheme, it’s easy to quickly and reliably verify any number is prime if I just give you a valid Pratt certificate, even if the certificate itself was very expensive to produce. But there’s a catch: for some large <em>p</em> where <em>p</em> - 1 cannot be completely factored in practice, we cannot produce a certificate at all. We’ll need new techniques to address this.</p>
</section>
<section id="the-group-mathbbz_p" class="level3" data-number="2.4.2">
<h3 data-number="2.4.2" class="anchored" data-anchor-id="the-group-mathbbz_p"><span class="header-section-number">2.4.2</span> The group <span class="math inline">\(\mathbb{Z}_p^*\)</span></h3>
</section>
<section id="order-of-an-element-and-lagranges-theorem" class="level3" data-number="2.4.3">
<h3 data-number="2.4.3" class="anchored" data-anchor-id="order-of-an-element-and-lagranges-theorem"><span class="header-section-number">2.4.3</span> Order of an element and Lagrange’s theorem</h3>
<p>Take a look at the powers of 3 mod 7:</p>
<p>3, 9, 27, 81, … (mod 7)</p>
<p>3, 2, 6, 4, 5, 1, 3, 2, 6, 4, 5, 1, 3, …</p>
<p>They form a cycle that repeats every 6 powers. This cycle length 6 is called the <strong>order</strong> of 3 in the group <span class="math inline">\(\mathbb{Z}_7^*\)</span>. This helps explain why Fermat’s Little Theorem is true: if we repeat every <em>n</em>−1 powers, and we started at a power of 1, we must come back around to where we started at the power <em>n</em>.</p>
<p>If we do the same thing with other values of <em>a</em>, it still repeats every 6 powers, but for some elements it may also repeat even faster than that:</p>
<div style="width: 50%;">
<table class="caption-top table">
<thead>
<tr class="header">
<th>a</th>
<th>a<sup>1</sup></th>
<th>a<sup>2</sup></th>
<th>a<sup>3</sup></th>
<th>a<sup>4</sup></th>
<th>a<sup>5</sup></th>
<th>a<sup>6</sup></th>
<th>a<sup>7</sup></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>2</strong></td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>2</td>
<td>4</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td><strong>3</strong></td>
<td>3</td>
<td>2</td>
<td>6</td>
<td>4</td>
<td>5</td>
<td>1</td>
<td>3</td>
</tr>
<tr class="odd">
<td><strong>4</strong></td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>4</td>
<td>2</td>
<td>1</td>
<td>4</td>
</tr>
<tr class="even">
<td><strong>5</strong></td>
<td>5</td>
<td>4</td>
<td>6</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>5</td>
</tr>
<tr class="odd">
<td><strong>6</strong></td>
<td>6</td>
<td>1</td>
<td>6</td>
<td>1</td>
<td>6</td>
<td>1</td>
<td>6</td>
</tr>
</tbody>
</table>
</div>
<p>Some elements have order 6, some order 3, and some order 2. All of them have order that is a factor of 6. In general, in the integers mod <em>p</em> for any prime <em>p</em>, all 1 ≤ <em>a</em> ≤ n-1 will have an order dividing <em>p</em>-1.</p>
<p>In group theory terms, this is a special case of Lagrange’s Theorem, which says that any subgroup of a group will have a size that divides the size of the full group. Here the full group is <span class="math inline">\(\mathbb{Z}_p^*\)</span>, the numbers 1 through <em>p</em>-1 with the operation of multiplication mod <em>p</em>, which has size <em>p</em>-1.</p>


<script type="pyodide-data">
eyJvcHRpb25zIjp7ImVudiI6eyJQTE9UTFlfUkVOREVSRVIiOiJwbG90bHlfbWltZXR5cGUifSwiaW5kZXhVUkwiOiJodHRwczovL2Nkbi5qc2RlbGl2ci5uZXQvcHlvZGlkZS92MC4yOC4xL2Z1bGwvIn0sInBhY2thZ2VzIjp7InBrZ3MiOlsicHlvZGlkZV9odHRwIiwibWljcm9waXAiLCJpcHl0aG9uIl19fQ==
</script>
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W3siY2VsbE5hbWUiOiJweW9kaWRlLTE0IiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTQgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTE0LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTQtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xNCA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEzIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTMgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTEzLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTMtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMyA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEyIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTIgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTEyLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTItY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMiA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTExIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTEgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTExLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTEtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMSA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTEsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEwIiwiaW5saW5lIjpmYWxzZSwibWV0aG9kTmFtZSI6ImludGVycHJldCIsInNvdXJjZSI6InZpZXdvZiBfcHlvZGlkZV9lZGl0b3JfMTAgPSB7XG4gIGNvbnN0IHsgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yLCBiNjREZWNvZGUgfSA9IHdpbmRvdy5fZXhlcmNpc2Vfb2pzX3J1bnRpbWU7XG5cbiAgY29uc3Qgc2NyaXB0Q29udGVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoYHNjcmlwdFt0eXBlPVxcXCJweW9kaWRlLTEwLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMTAtY29udGVudHNgIH0sIGJsb2NrLmF0dHIpO1xuICBjb25zdCBlZGl0b3IgPSBuZXcgUHlvZGlkZUV4ZXJjaXNlRWRpdG9yKFxuICAgIHB5b2RpZGVPanMucHlvZGlkZVByb21pc2UsXG4gICAgYmxvY2suY29kZSxcbiAgICBvcHRpb25zXG4gICk7XG5cbiAgcmV0dXJuIGVkaXRvci5jb250YWluZXI7XG59XG5fcHlvZGlkZV92YWx1ZV8xMCA9IHB5b2RpZGVPanMucHJvY2VzcyhfcHlvZGlkZV9lZGl0b3JfMTAsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTkiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl85ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS05LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtOS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzkgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzksIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTgiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl84ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS04LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtOC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzggPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzgsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTciLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl83ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS03LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzcgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzcsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTYiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl82ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS02LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzYgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzYsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTUiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl81ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS01LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNS1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzUgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzUsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTQiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl80ID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS00LWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtNC1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzQgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzQsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTMiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8zID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0zLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMy1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzMgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzMsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTIiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoidmlld29mIF9weW9kaWRlX2VkaXRvcl8yID0ge1xuICBjb25zdCB7IFB5b2RpZGVFeGVyY2lzZUVkaXRvciwgYjY0RGVjb2RlIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0yLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oeyBpZDogYHB5b2RpZGUtMi1jb250ZW50c2AgfSwgYmxvY2suYXR0cik7XG4gIGNvbnN0IGVkaXRvciA9IG5ldyBQeW9kaWRlRXhlcmNpc2VFZGl0b3IoXG4gICAgcHlvZGlkZU9qcy5weW9kaWRlUHJvbWlzZSxcbiAgICBibG9jay5jb2RlLFxuICAgIG9wdGlvbnNcbiAgKTtcblxuICByZXR1cm4gZWRpdG9yLmNvbnRhaW5lcjtcbn1cbl9weW9kaWRlX3ZhbHVlXzIgPSBweW9kaWRlT2pzLnByb2Nlc3MoX3B5b2RpZGVfZWRpdG9yXzIsIHt9KTtcbiJ9LHsiY2VsbE5hbWUiOiJweW9kaWRlLTEiLCJpbmxpbmUiOmZhbHNlLCJtZXRob2ROYW1lIjoiaW50ZXJwcmV0Iiwic291cmNlIjoiX3B5b2RpZGVfdmFsdWVfMSA9IHtcbiAgY29uc3QgeyBoaWdobGlnaHRQeXRob24sIGI2NERlY29kZX0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHNjcmlwdENvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwicHlvZGlkZS0xLWNvbnRlbnRzXFxcIl1gKS50ZXh0Q29udGVudDtcbiAgY29uc3QgYmxvY2sgPSBKU09OLnBhcnNlKGI2NERlY29kZShzY3JpcHRDb250ZW50KSk7XG5cbiAgLy8gRGVmYXVsdCBldmFsdWF0aW9uIGNvbmZpZ3VyYXRpb25cbiAgY29uc3Qgb3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oe1xuICAgIGlkOiBcInB5b2RpZGUtMS1jb250ZW50c1wiLFxuICAgIGVjaG86IHRydWUsXG4gICAgb3V0cHV0OiB0cnVlXG4gIH0sIGJsb2NrLmF0dHIpO1xuXG4gIC8vIEV2YWx1YXRlIHRoZSBwcm92aWRlZCBQeXRob24gY29kZVxuICBjb25zdCByZXN1bHQgPSBweW9kaWRlT2pzLnByb2Nlc3Moe2NvZGU6IGJsb2NrLmNvZGUsIG9wdGlvbnN9LCB7fSk7XG5cbiAgLy8gRWFybHkgeWllbGQgd2hpbGUgd2Ugd2FpdCBmb3IgdGhlIGZpcnN0IGV2YWx1YXRpb24gYW5kIHJlbmRlclxuICBpZiAob3B0aW9ucy5vdXRwdXQgJiYgIShcIjFcIiBpbiBweW9kaWRlT2pzLnJlbmRlcmVkT2pzKSkge1xuICAgIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgY29uc3Qgc3Bpbm5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG5cbiAgICBpZiAob3B0aW9ucy5lY2hvKSB7XG4gICAgICAvLyBTaG93IG91dHB1dCBhcyBoaWdobGlnaHRlZCBzb3VyY2VcbiAgICAgIGNvbnN0IHByZUVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwicHJlXCIpO1xuICAgICAgY29udGFpbmVyLmNsYXNzTmFtZSA9IFwic291cmNlQ29kZVwiO1xuICAgICAgcHJlRWxlbS5jbGFzc05hbWUgPSBcInNvdXJjZUNvZGUgcHl0aG9uXCI7XG4gICAgICBwcmVFbGVtLmFwcGVuZENoaWxkKGhpZ2hsaWdodFB5dGhvbihibG9jay5jb2RlKSk7XG4gICAgICBzcGlubmVyLmNsYXNzTmFtZSA9IFwic3Bpbm5lci1ncm93IHNwaW5uZXItZ3Jvdy1zbSBtLTIgcG9zaXRpb24tYWJzb2x1dGUgdG9wLTAgZW5kLTBcIjtcbiAgICAgIHByZUVsZW0uYXBwZW5kQ2hpbGQoc3Bpbm5lcik7XG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQocHJlRWxlbSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHNwaW5uZXIuY2xhc3NOYW1lID0gXCJzcGlubmVyLWJvcmRlciBzcGlubmVyLWJvcmRlci1zbVwiO1xuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHNwaW5uZXIpO1xuICAgIH1cblxuICAgIHlpZWxkIGNvbnRhaW5lcjtcbiAgfVxuXG4gIHB5b2RpZGVPanMucmVuZGVyZWRPanNbXCIxXCJdID0gdHJ1ZTtcbiAgeWllbGQgYXdhaXQgcmVzdWx0O1xufVxuIn0seyJjZWxsTmFtZSI6InB5b2RpZGUtcHJlbHVkZSIsImlubGluZSI6ZmFsc2UsIm1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InB5b2RpZGVPanMgPSB7XG4gIGNvbnN0IHtcbiAgICBQeW9kaWRlRXZhbHVhdG9yLFxuICAgIFB5b2RpZGVFbnZpcm9ubWVudE1hbmFnZXIsXG4gICAgc2V0dXBQeXRob24sXG4gICAgc3RhcnRQeW9kaWRlV29ya2VyLFxuICAgIGI2NERlY29kZSxcbiAgICBjb2xsYXBzZVBhdGgsXG4gIH0gPSB3aW5kb3cuX2V4ZXJjaXNlX29qc19ydW50aW1lO1xuXG4gIGNvbnN0IHN0YXR1c0NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1zdGF0dXNcIik7XG4gIGNvbnN0IGluZGljYXRvckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiZXhlcmNpc2UtbG9hZGluZy1pbmRpY2F0b3JcIik7XG4gIGluZGljYXRvckNvbnRhaW5lci5jbGFzc0xpc3QucmVtb3ZlKFwiZC1ub25lXCIpO1xuXG4gIGxldCBzdGF0dXNUZXh0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKVxuICBzdGF0dXNUZXh0LmNsYXNzTGlzdCA9IFwiZXhlcmNpc2UtbG9hZGluZy1kZXRhaWxzXCI7XG4gIHN0YXR1c1RleHQgPSBzdGF0dXNDb250YWluZXIuYXBwZW5kQ2hpbGQoc3RhdHVzVGV4dCk7XG4gIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgSW5pdGlhbGlzZWA7XG5cbiAgLy8gSG9pc3QgaW5kaWNhdG9yIG91dCBmcm9tIGZpbmFsIHNsaWRlIHdoZW4gcnVubmluZyB1bmRlciByZXZlYWxcbiAgY29uc3QgcmV2ZWFsU3RhdHVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5yZXZlYWwgLmV4ZXJjaXNlLWxvYWRpbmctaW5kaWNhdG9yXCIpO1xuICBpZiAocmV2ZWFsU3RhdHVzKSB7XG4gICAgcmV2ZWFsU3RhdHVzLnJlbW92ZSgpO1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucmV2ZWFsID4gLnNsaWRlc1wiKS5hcHBlbmRDaGlsZChyZXZlYWxTdGF0dXMpO1xuICB9XG5cbiAgLy8gTWFrZSBhbnkgcmV2ZWFsIHNsaWRlcyB3aXRoIGxpdmUgY2VsbHMgc2Nyb2xsYWJsZVxuICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJldmVhbCAuZXhlcmNpc2UtY2VsbFwiKS5mb3JFYWNoKChlbCkgPT4ge1xuICAgIGVsLmNsb3Nlc3QoJ3NlY3Rpb24uc2xpZGUnKS5jbGFzc0xpc3QuYWRkKFwic2Nyb2xsYWJsZVwiKTtcbiAgfSlcblxuICAvLyBQeW9kaWRlIHN1cHBsZW1lbnRhbCBkYXRhIGFuZCBvcHRpb25zXG4gIGNvbnN0IGRhdGFDb250ZW50ID0gZG9jdW1lbnQucXVlcnlTZWxlY3Rvcihgc2NyaXB0W3R5cGU9XFxcInB5b2RpZGUtZGF0YVxcXCJdYCkudGV4dENvbnRlbnQ7XG4gIGNvbnN0IGRhdGEgPSBKU09OLnBhcnNlKGI2NERlY29kZShkYXRhQ29udGVudCkpO1xuXG4gIC8vIEdyYWIgbGlzdCBvZiByZXNvdXJjZXMgdG8gYmUgZG93bmxvYWRlZFxuICBjb25zdCBmaWxlc0NvbnRlbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKGBzY3JpcHRbdHlwZT1cXFwidmZzLWZpbGVcXFwiXWApLnRleHRDb250ZW50O1xuICBjb25zdCBmaWxlcyA9IEpTT04ucGFyc2UoYjY0RGVjb2RlKGZpbGVzQ29udGVudCkpO1xuXG4gIGxldCBweW9kaWRlUHJvbWlzZSA9IChhc3luYyAoKSA9PiB7XG4gICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyBQeW9kaWRlYDtcbiAgICBjb25zdCBweW9kaWRlID0gYXdhaXQgc3RhcnRQeW9kaWRlV29ya2VyKGRhdGEub3B0aW9ucyk7XG5cbiAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6IG1pY3JvcGlwYDtcbiAgICBhd2FpdCBweW9kaWRlLmxvYWRQYWNrYWdlKFwibWljcm9waXBcIik7XG4gICAgY29uc3QgbWljcm9waXAgPSBhd2FpdCBweW9kaWRlLnB5aW1wb3J0KFwibWljcm9waXBcIik7XG4gICAgYXdhaXQgZGF0YS5wYWNrYWdlcy5wa2dzLm1hcCgocGtnKSA9PiAoKSA9PiB7XG4gICAgICBzdGF0dXNUZXh0LnRleHRDb250ZW50ID0gYERvd25sb2FkaW5nIHBhY2thZ2U6ICR7cGtnfWA7XG4gICAgICByZXR1cm4gbWljcm9waXAuaW5zdGFsbChwa2cpO1xuICAgIH0pLnJlZHVjZSgoY3VyLCBuZXh0KSA9PiBjdXIudGhlbihuZXh0KSwgUHJvbWlzZS5yZXNvbHZlKCkpO1xuICAgIGF3YWl0IG1pY3JvcGlwLmRlc3Ryb3koKTtcblxuICAgIC8vIERvd25sb2FkIGFuZCBpbnN0YWxsIHJlc291cmNlc1xuICAgIGF3YWl0IGZpbGVzLm1hcCgoZmlsZSkgPT4gYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgbmFtZSA9IGZpbGUuc3Vic3RyaW5nKGZpbGUubGFzdEluZGV4T2YoJy8nKSArIDEpO1xuICAgICAgc3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IGBEb3dubG9hZGluZyByZXNvdXJjZTogJHtuYW1lfWA7XG4gICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGZpbGUpO1xuICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYENhbid0IGRvd25sb2FkIFxcYCR7ZmlsZX1cXGAuIEVycm9yICR7cmVzcG9uc2Uuc3RhdHVzfTogXCIke3Jlc3BvbnNlLnN0YXR1c1RleHR9XCIuYCk7XG4gICAgICB9XG4gICAgICBjb25zdCBkYXRhID0gYXdhaXQgcmVzcG9uc2UuYXJyYXlCdWZmZXIoKTtcblxuICAgICAgLy8gU3RvcmUgVVJMcyBpbiB0aGUgY3dkIHdpdGhvdXQgYW55IHN1YmRpcmVjdG9yeSBzdHJ1Y3R1cmVcbiAgICAgIGlmIChmaWxlLmluY2x1ZGVzKFwiOi8vXCIpKSB7XG4gICAgICAgIGZpbGUgPSBuYW1lO1xuICAgICAgfVxuXG4gICAgICAvLyBDb2xsYXBzZSBoaWdoZXIgZGlyZWN0b3J5IHN0cnVjdHVyZVxuICAgICAgZmlsZSA9IGNvbGxhcHNlUGF0aChmaWxlKTtcblxuICAgICAgLy8gQ3JlYXRlIGRpcmVjdG9yeSB0cmVlLCBpZ25vcmluZyBcImRpcmVjdG9yeSBleGlzdHNcIiBWRlMgZXJyb3JzXG4gICAgICBjb25zdCBwYXJ0cyA9IGZpbGUuc3BsaXQoJy8nKS5zbGljZSgwLCAtMSk7XG4gICAgICBsZXQgcGF0aCA9ICcnO1xuICAgICAgd2hpbGUgKHBhcnRzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgcGF0aCArPSBwYXJ0cy5zaGlmdCgpICsgJy8nO1xuICAgICAgICB0cnkge1xuICAgICAgICAgIGF3YWl0IHB5b2RpZGUuRlMubWtkaXIocGF0aCk7XG4gICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICBpZiAoZS5uYW1lICE9PSBcIkVycm5vRXJyb3JcIikgdGhyb3cgZTtcbiAgICAgICAgICBpZiAoZS5lcnJubyAhPT0gMjApIHtcbiAgICAgICAgICAgIGNvbnN0IGVycm9yVGV4dFB0ciA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5fc3RyZXJyb3IoZS5lcnJubyk7XG4gICAgICAgICAgICBjb25zdCBlcnJvclRleHQgPSBhd2FpdCBweW9kaWRlLl9tb2R1bGUuVVRGOFRvU3RyaW5nKGVycm9yVGV4dFB0cik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEZpbGVzeXN0ZW0gRXJyb3IgJHtlLmVycm5vfSBcIiR7ZXJyb3JUZXh0fVwiLmApO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICAvLyBXcml0ZSB0aGlzIGZpbGUgdG8gdGhlIFZGU1xuICAgICAgdHJ5IHtcbiAgICAgICAgcmV0dXJuIGF3YWl0IHB5b2RpZGUuRlMud3JpdGVGaWxlKGZpbGUsIG5ldyBVaW50OEFycmF5KGRhdGEpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUubmFtZSAhPT0gXCJFcnJub0Vycm9yXCIpIHRocm93IGU7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dFB0ciA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5fc3RyZXJyb3IoZS5lcnJubyk7XG4gICAgICAgIGNvbnN0IGVycm9yVGV4dCA9IGF3YWl0IHB5b2RpZGUuX21vZHVsZS5VVEY4VG9TdHJpbmcoZXJyb3JUZXh0UHRyKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBGaWxlc3lzdGVtIEVycm9yICR7ZS5lcnJub30gXCIke2Vycm9yVGV4dH1cIi5gKTtcbiAgICAgIH1cbiAgICB9KS5yZWR1Y2UoKGN1ciwgbmV4dCkgPT4gY3VyLnRoZW4obmV4dCksIFByb21pc2UucmVzb2x2ZSgpKTtcblxuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBgUHlvZGlkZSBlbnZpcm9ubWVudCBzZXR1cGA7XG4gICAgYXdhaXQgc2V0dXBQeXRob24ocHlvZGlkZSk7XG5cbiAgICBzdGF0dXNUZXh0LnJlbW92ZSgpO1xuICAgIGlmIChzdGF0dXNDb250YWluZXIuY2hpbGRyZW4ubGVuZ3RoID09IDApIHtcbiAgICAgIHN0YXR1c0NvbnRhaW5lci5wYXJlbnROb2RlLnJlbW92ZSgpO1xuICAgIH1cbiAgICByZXR1cm4gcHlvZGlkZTtcbiAgfSkoKS5jYXRjaCgoZXJyKSA9PiB7XG4gICAgc3RhdHVzVGV4dC5zdHlsZS5jb2xvciA9IFwidmFyKC0tZXhlcmNpc2UtZWRpdG9yLWhsLWVyLCAjQUQwMDAwKVwiO1xuICAgIHN0YXR1c1RleHQudGV4dENvbnRlbnQgPSBlcnIubWVzc2FnZTtcbiAgICAvL2luZGljYXRvckNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKFwiLnNwaW5uZXItZ3Jvd1wiKS5jbGFzc0xpc3QuYWRkKFwiZC1ub25lXCIpO1xuICAgIHRocm93IGVycjtcbiAgfSk7XG5cbiAgLy8gS2VlcCB0cmFjayBvZiBpbml0aWFsIE9KUyBibG9jayByZW5kZXJcbiAgY29uc3QgcmVuZGVyZWRPanMgPSB7fTtcblxuICBjb25zdCBwcm9jZXNzID0gYXN5bmMgKGNvbnRleHQsIGlucHV0cykgPT4ge1xuICAgIGNvbnN0IHB5b2RpZGUgPSBhd2FpdCBweW9kaWRlUHJvbWlzZTtcbiAgICBjb25zdCBldmFsdWF0b3IgPSBuZXcgUHlvZGlkZUV2YWx1YXRvcihweW9kaWRlLCBjb250ZXh0KTtcbiAgICBhd2FpdCBldmFsdWF0b3IucHJvY2VzcyhpbnB1dHMpO1xuICAgIHJldHVybiBldmFsdWF0b3IuY29udGFpbmVyO1xuICB9XG5cbiAgcmV0dXJuIHtcbiAgICBweW9kaWRlUHJvbWlzZSxcbiAgICByZW5kZXJlZE9qcyxcbiAgICBwcm9jZXNzLFxuICB9O1xufVxuIn1dfQ==
</script>
<div id="exercise-loading-indicator" class="exercise-loading-indicator d-none d-flex align-items-center gap-2">
<div id="exercise-loading-status" class="d-flex gap-2">

</div>
<div class="spinner-grow spinner-grow-sm">

</div>
</div>
<script type="vfs-file">
WyIuLi9zcmMvY2hhcHRlcjEvX19pbml0X18ucHkiXQ==
</script>
</section>
</section>

</main> <!-- /main -->
<script type="ojs-module-contents">
eyJjb250ZW50cyI6W119
</script>
<script type="module">
if (window.location.protocol === "file:") { alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."); }
window._ojs.paths.runtimeToDoc = "../../primality-testing";
window._ojs.paths.runtimeToRoot = "../..";
window._ojs.paths.docToRoot = "..";
window._ojs.selfContained = false;
window._ojs.runtime.interpretFromScriptTags();
</script>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../trial-division/index.html" class="pagination-link" aria-label="Trial Division">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Trial Division</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../references/index.html" class="pagination-link" aria-label="References">
        <span class="nav-page-text">References</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>